!function(){"use strict";function e(e,t,r,l,o){e.html5Mode(!0),r.otherwise("/"),l.strictMode(!1),t.state("overview",{url:"/",templateUrl:"overview/main.html",controller:"Overview.MainController",controllerAs:"vm",data:{selectedTab:0}}).state("users",{url:"/users",templateUrl:"users/main.html",controller:"Users.MainController",controllerAs:"vm",data:{selectedTab:1}}).state("users.add",{url:"/add",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"}).state("users.edit",{url:"/edit/:_id",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"}).state("generic",{url:"/:dataType",templateUrl:function(e){return e.dataType+"/main.html"},controller:"Generic.MainController",controllerAs:"vm"}).state("generic.add",{url:"/add",templateUrl:function(e){return e.dataType+"/add-edit.html"},controller:"Generic.AddEditController",controllerAs:"vm"}).state("generic.edit",{url:"/edit/:_id",templateUrl:function(e){return e.dataType+"/add-edit.html"},controller:"Generic.AddEditController",controllerAs:"vm"})}function t(e,t){e.apiUrl="http://localhost:3001",t.get("/token").then(function(e){t.defaults.headers.common.Authorization="Bearer "+e.data})}e.$inject=["$locationProvider","$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$mdThemingProvider"],t.$inject=["$rootScope","$http"],angular.module("app",["ngMaterial","md.data.table","ngAnimate","ngMessages","ui.router","ngFileUpload","wj"]).config(e).run(t)}();
!function(){"use strict";function c(c){return c("cache")}c.$inject=["$cacheFactory"],angular.module("app").factory("Cache",c)}();
!function(){"use strict";function t(t,e,n,r,i){function c(o){return function(){var u=n.defer();return r.get(o)?u.resolve(r.get(o)):e.get(t.apiUrl+"/"+o).then(function(t){r.put(o,t.data),u.resolve(t.data)})["catch"](function(t){u.reject(t.data)}),i.On(o,function(e){c(o)().then(function(n){switch(e.action){case"created":n.push(e.item),r.put(o,n);break;case"updated":var i=_.findIndex(n,{_id:e.item._id});n[i]=e.item,r.put(o,n);break;case"deleted":n=_.without(n,_.findWhere(n,{_id:e._id})),r.put(o,n)}t.$broadcast(o,e)})}),u.promise}}function o(t){return function(e){return c(t)().then(function(t){return _.findWhere(t,{_id:e})})}}function u(r){return function(i){var c=n.defer();return console.log("posting",t.apiUrl+"/"+r),console.log("item",i),e.post(t.apiUrl+"/"+r,i).then(function(t){c.resolve()})["catch"](function(t){c.reject(t.data)}),c.promise}}function a(r){return function(i){var c=n.defer();return e.put(t.apiUrl+"/"+r+"/"+i._id,i).then(function(t){c.resolve()})["catch"](function(t){c.reject(t.data)}),c.promise}}function f(r){return function(i){var c=n.defer();return e["delete"](t.apiUrl+"/"+r+"/"+i).then(function(t){c.resolve()})["catch"](function(t){c.reject(t.data)}),c.promise}}return function(t){var e={};return e.GetAll=c(t),e.GetById=o(t),e.Create=u(t),e.Update=a(t),e.Delete=f(t),e}}t.$inject=["$rootScope","$http","$q","Cache","Socket"],angular.module("app").factory("DataService",t)}();
!function(){"use strict";function e(e,t,o){function a(o){t["delete"](e.apiUrl+o.path)}var l={};return l.Upload=o.upload,l.Delete=a,l}e.$inject=["$rootScope","$http","Upload"],angular.module("app").factory("FileService",e)}();
!function(){"use strict";function t(t,e,n,i,a){function c(){n._id&&(u.GetById(n._id).then(function(t){$.extend(!0,o.item,t)}),t.$on(r,function(t,e){var n=e.item&&e.item._id||e._id;n===o.item._id&&n!==o.updatedId&&a.Error("This item was just "+e.action+" by another user")}))}function d(n){function i(){u.Create(n).then(function(){o.saved=!0,e.go("generic",{dataType:r}),a.Success("Item created")})["catch"](function(t){a.Error(t)})}function c(){o.updatedId=n._id,u.Update(n).then(function(){o.saved=!0,e.go("generic",{dataType:r}),a.Success("Item updated")})["catch"](function(t){a.Error(t)})}t.form.$invalid||(n._id?c():i())}var o=this,r=n.dataType,u=i(r);o.item={},o.saveItem=d,c()}t.$inject=["$scope","$state","$stateParams","DataService","ToastService"],angular.module("app").controller("Generic.AddEditController",t)}();
!function(){"use strict";function t(t,e,n,a){function o(){c(),t.$on(r,c)}function c(){u.GetAll().then(function(t){l[r]=t})}function i(t){u.Delete(t)}var l=this,r=n.dataType,u=a(r);l.dataType=r,l[r]=[],l.deleteItem=i,o()}t.$inject=["$scope","$state","$stateParams","DataService"],angular.module("app").controller("Generic.MainController",t)}();
!function(){"use strict";function n(n){function t(t,o){_.contains(n.socketListeners,t)||(n.socketListeners.push(t),c.on(t,function(){var t=arguments;n.$apply(function(){o.apply(c,t)})}))}function o(t,o,e){c.emit(t,o,function(){var t=arguments;n.$apply(function(){e&&e.apply(c,t)})})}var c=io.connect(n.apiUrl),e={};return e.On=t,e.Emit=o,n.socketListeners=[],e}n.$inject=["$rootScope"],angular.module("app").factory("Socket",n)}();
!function(){"use strict";function e(e){function t(t){return function(r){function o(){var t=this;t.message=r,t.close=e.hide}e.show({controller:o,controllerAs:"vm",templateUrl:"toast-"+t+"-template.html",hideDelay:6e3})}}var r={};return r.Success=t("success"),r.Error=t("error"),r}e.$inject=["$mdToast"],angular.module("app").factory("ToastService",e)}();
!function(){"use strict";function e(e){var a=this;a.selectedTab=0,a.tabs=[{name:"Overview",path:"/"},{name:"Users",path:"/users"},{name:"Services",path:"/services"},{name:"Staff",path:"/staff"},{name:"News",path:"/news"},{name:"Events",path:"/events"}],e.$on("$stateChangeSuccess",function(e,t,s,n,c){t.data&&t.data.selectedTab?a.selectedTab=t.data.selectedTab:s.dataType&&_.find(a.tabs,function(e,t){s.dataType===e.name.toLowerCase()&&(a.selectedTab=t)})})}e.$inject=["$rootScope"],angular.module("app").controller("TabsController",e)}();
!function(){"use strict";function n(){}angular.module("app").controller("Overview.MainController",n)}();
!function(){"use strict";function e(e,s,r,i,t,n){function u(){r._id&&(f.title="Edit User",d.GetById(r._id).then(function(e){$.extend(!0,f.user,e)}),e.$on("users",function(e,s){var r=s.item&&s.item._id||s._id;r===f.user._id&&r!==f.updatedId&&t.Error("This user was just "+s.action+" by another user")})),e.$watch("files",function(){o(e.files)}),e.$on("$destroy",function(){if(!f.saved&&f.user.files){var e=_.filter(f.user.files,function(e){return!e.saved});_.each(e,function(e){n.Delete(e)})}})}function a(r){function i(){d.Create(r).then(function(){f.saved=!0,s.go("users"),t.Success("User created")})["catch"](function(e){t.Error(e)})}function u(){f.updatedId=r._id,d.Update(r).then(function(){f.saved=!0,f.filesToDelete&&_.each(f.filesToDelete,function(e){n.Delete(e)}),s.go("users"),t.Success("User updated")})["catch"](function(e){t.Error(e)})}e.userForm.$invalid||(r._id?u():i())}function o(s){if(s&&s.length){f.user.files=f.user.files||[],f.failedUploads=f.failedUploads||[];for(var r=0;r<s.length;r++){var i=s[r];i.progress=0;var t=_.findWhere(f.user.files,{name:i.name});t&&l(t),f.user.files.push(_.clone(i)),n.Upload({url:e.apiUrl+"/uploads",file:i}).progress(function(e){var s=_.findWhere(f.user.files,{name:e.config.file.name});s.path||(s.progress=parseInt(100*e.loaded/e.total))}).success(function(e,s,r,i){var t=_.findWhere(f.user.files,{name:i.file.name});delete t.progress,t.path="/uploads/"+e}).error(function(e,s,r,i){var t=_.findWhere(f.user.files,{name:i.file.name});f.user.files=_.without(f.user.files,_.findWhere(f.user.files,t)),t.error=s+" "+e,f.failedUploads.push(t)})}}}function l(e){f.user.files=_.without(f.user.files,_.findWhere(f.user.files,{name:e.name})),e.saved?(f.filesToDelete=f.filesToDelete||[],f.filesToDelete.push(e)):n.Delete(e)}var f=this,d=i("users");f.title="Add User",f.user={},f.saveUser=a,f.removeFile=l,u()}e.$inject=["$scope","$state","$stateParams","DataService","ToastService","FileService"],angular.module("app").controller("Users.AddEditController",e)}();
!function(){"use strict";function e(e,n){function t(){s(),e.$on("users",s)}function s(){u.GetAll().then(function(e){o.users=e})}function r(e){u.Delete(e)}var o=this,u=n("users");o.users=[],o.deleteUser=r,t()}e.$inject=["$scope","DataService"],angular.module("app").controller("Users.MainController",e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC1zZXJ2aWNlcy9jYWNoZS5qcyIsImFwcC1zZXJ2aWNlcy9kYXRhLnNlcnZpY2UuanMiLCJhcHAtc2VydmljZXMvZmlsZS5zZXJ2aWNlLmpzIiwiYXBwLXNlcnZpY2VzL2dlbmVyaWMuYWRkLWVkaXQuY29udHJvbGxlci5qcyIsImFwcC1zZXJ2aWNlcy9nZW5lcmljLm1haW4uY29udHJvbGxlci5qcyIsImFwcC1zZXJ2aWNlcy9zb2NrZXQuanMiLCJhcHAtc2VydmljZXMvdG9hc3Quc2VydmljZS5qcyIsImxheW91dC90YWJzLmNvbnRyb2xsZXIuanMiLCJvdmVydmlldy9tYWluLmNvbnRyb2xsZXIuanMiLCJ1c2Vycy9hZGQtZWRpdC5jb250cm9sbGVyLmpzIiwidXNlcnMvbWFpbi5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInN0cmljdE1vZGUiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsImRhdGEiLCJzZWxlY3RlZFRhYiIsIiRzdGF0ZVBhcmFtcyIsImRhdGFUeXBlIiwicnVuIiwiJHJvb3RTY29wZSIsIiRodHRwIiwiYXBpVXJsIiwiZ2V0IiwidGhlbiIsInJlcyIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsIiRpbmplY3QiLCJhbmd1bGFyIiwibW9kdWxlIiwiU2VydmljZSIsIiRjYWNoZUZhY3RvcnkiLCJmYWN0b3J5IiwiJHEiLCJDYWNoZSIsIlNvY2tldCIsIkdldEFsbCIsInR5cGUiLCJkZWZlcnJlZCIsImRlZmVyIiwicmVzb2x2ZSIsInB1dCIsInJlamVjdCIsIk9uIiwiaXRlbXMiLCJhY3Rpb24iLCJwdXNoIiwiaXRlbSIsImluZGV4IiwiXyIsImZpbmRJbmRleCIsIl9pZCIsIndpdGhvdXQiLCJmaW5kV2hlcmUiLCIkYnJvYWRjYXN0IiwicHJvbWlzZSIsIkdldEJ5SWQiLCJDcmVhdGUiLCJjb25zb2xlIiwibG9nIiwicG9zdCIsIlVwZGF0ZSIsIkRlbGV0ZSIsInNlcnZpY2UiLCJVcGxvYWQiLCJkZWxldGVGaWxlIiwiZmlsZSIsInBhdGgiLCJ1cGxvYWQiLCJDb250cm9sbGVyIiwiJHNjb3BlIiwiJHN0YXRlIiwiRGF0YVNlcnZpY2UiLCJUb2FzdFNlcnZpY2UiLCJpbml0Q29udHJvbGxlciIsIiQiLCJleHRlbmQiLCJ2bSIsIiRvbiIsImV2ZW50IiwidXBkYXRlZElkIiwiRXJyb3IiLCJzYXZlSXRlbSIsImNyZWF0ZUl0ZW0iLCJzYXZlZCIsImdvIiwiU3VjY2VzcyIsImVycm9yIiwidXBkYXRlSXRlbSIsImZvcm0iLCIkaW52YWxpZCIsInRoaXMiLCJsb2FkSXRlbXMiLCJkZWxldGVJdGVtIiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJjb250YWlucyIsInNvY2tldExpc3RlbmVycyIsInNvY2tldCIsIm9uIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5IiwiRW1pdCIsImVtaXQiLCJpbyIsImNvbm5lY3QiLCIkbWRUb2FzdCIsIkZsYXNoIiwibWVzc2FnZSIsImNsb3NlIiwiaGlkZSIsInNob3ciLCJoaWRlRGVsYXkiLCJ0YWJzIiwibmFtZSIsInRvU3RhdGUiLCJ0b1BhcmFtcyIsImZyb21TdGF0ZSIsImZyb21QYXJhbXMiLCJmaW5kIiwidGFiIiwidG9Mb3dlckNhc2UiLCJGaWxlU2VydmljZSIsInRpdGxlIiwiVXNlclNlcnZpY2UiLCJ1c2VyIiwiJHdhdGNoIiwidXBsb2FkRmlsZXMiLCJmaWxlcyIsInVuc2F2ZWRGaWxlcyIsImZpbHRlciIsImVhY2giLCJzYXZlVXNlciIsImNyZWF0ZVVzZXIiLCJ1cGRhdGVVc2VyIiwiZmlsZXNUb0RlbGV0ZSIsInVzZXJGb3JtIiwibGVuZ3RoIiwiZmFpbGVkVXBsb2FkcyIsImkiLCJwcm9ncmVzcyIsImV4aXN0aW5nRmlsZSIsInJlbW92ZUZpbGUiLCJjbG9uZSIsImV2dCIsInBhcnNlSW50IiwibG9hZGVkIiwidG90YWwiLCJzdWNjZXNzIiwic3RhdHVzIiwibG9hZFVzZXJzIiwidXNlcnMiLCJkZWxldGVVc2VyIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNJLFlBU0EsU0FBU0EsR0FBT0MsRUFBbUJDLEVBQWdCQyxFQUFvQkMsRUFBNEJDLEdBQy9GSixFQUFrQkssV0FBVSxHQUc1QkgsRUFBbUJJLFVBQVUsS0FHN0JILEVBQTJCSSxZQUFXLEdBRXRDTixFQUNLTyxNQUFNLFlBQ0hDLElBQUssSUFDTEMsWUFBYSxxQkFDYkMsV0FBWSwwQkFDWkMsYUFBYyxLQUNkQyxNQUFRQyxZQUFhLEtBRXhCTixNQUFNLFNBQ0hDLElBQUssU0FDTEMsWUFBYSxrQkFDYkMsV0FBWSx1QkFDWkMsYUFBYyxLQUNkQyxNQUFRQyxZQUFhLEtBRXBCTixNQUFNLGFBQ0hDLElBQUssT0FDTEMsWUFBYSxzQkFDYkMsV0FBWSwwQkFDWkMsYUFBYyxPQUVqQkosTUFBTSxjQUNIQyxJQUFLLGFBQ0xDLFlBQWEsc0JBQ2JDLFdBQVksMEJBQ1pDLGFBQWMsT0FFekJKLE1BQU0sV0FDSEMsSUFBSyxhQUNMQyxZQUFhLFNBQVVLLEdBQ25CLE1BQU9BLEdBQWFDLFNBQVcsY0FFbkNMLFdBQVkseUJBQ1pDLGFBQWMsT0FFYkosTUFBTSxlQUNIQyxJQUFLLE9BQ0xDLFlBQWEsU0FBVUssR0FDbkIsTUFBT0EsR0FBYUMsU0FBVyxrQkFFbkNMLFdBQVksNEJBQ1pDLGFBQWMsT0FFakJKLE1BQU0sZ0JBQ0hDLElBQUssYUFDTEMsWUFBYSxTQUFVSyxHQUNuQixNQUFPQSxHQUFhQyxTQUFXLGtCQUVuQ0wsV0FBWSw0QkFDWkMsYUFBYyxPQUkxQixRQUFTSyxHQUFJQyxFQUFZQyxHQUNyQkQsRUFBV0UsT0FBUyx3QkFFcEJELEVBQU1FLElBQUksVUFBVUMsS0FBSyxTQUFV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QixFQUFHa0QsS0FBS0csT0FBU2QsS0FBTWxELEVBQUtrRCxRQUU1RWxELEVBQUtrQixPQUtOUCxFQUFHNEQsY0FBZ0I1RCxFQUFHNEQsa0JBQ3RCNUQsRUFBRzRELGNBQWMzRixLQUFLb0IsSUFKdEIwRCxFQUFZOUQsT0FBT0ksR0F2STNCLEdBQUlXLEdBQUtjLEtBQ0xtQyxFQUFjdEQsRUFBWSxRQUU5QkssR0FBR2dELE1BQVEsV0FDWGhELEVBQUdrRCxRQUNIbEQsRUFBR3lELFNBQVdBLEVBQ2R6RCxFQUFHbUUsV0FBYUEsRUFFaEJ0RSxJQWRKTCxFQUFXMUMsU0FBVyxTQUFVLFNBQVUsZUFBZ0IsY0FBZSxlQUFnQixlQUN6RkMsUUFDS0MsT0FBTyxPQUNQbEIsV0FBVywwQkFBMkIwRDtDQ04vQyxXQUNJLFlBT0EsU0FBU0EsR0FBV0MsRUFBUUUsR0FTeEIsUUFBU0UsS0FDTDhFLElBR0FsRixFQUFPUSxJQUFJLFFBQVMwRSxHQUd4QixRQUFTQSxLQUNMMUIsRUFBWTFGLFNBQ1BkLEtBQUssU0FBVW1JLEdBQ1o1RSxFQUFHNEUsTUFBUUEsSUFJdkIsUUFBU0MsR0FBV3ZHLEdBQ2hCMkUsRUFBWWhFLE9BQU9YLEdBdkJ2QixHQUFJMEIsR0FBS2MsS0FDTG1DLEVBQWN0RCxFQUFZLFFBRTlCSyxHQUFHNEUsU0FDSDVFLEVBQUc2RSxXQUFhQSxFQUVoQmhGLElBWkpMLEVBQVcxQyxTQUFXLFNBQVUsZUFDaENDLFFBQ0tDLE9BQU8sT0FDUGxCLFdBQVcsdUJBQXdCMEQiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgY29uZmlnLiRpbmplY3QgPSBbXCIkbG9jYXRpb25Qcm92aWRlclwiLCBcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIFwiJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXJcIiwgXCIkbWRUaGVtaW5nUHJvdmlkZXJcIl07XHJcbiAgICBydW4uJGluamVjdCA9IFtcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnLCBbJ25nTWF0ZXJpYWwnLCAnbWQuZGF0YS50YWJsZScsICduZ0FuaW1hdGUnLCAnbmdNZXNzYWdlcycsICd1aS5yb3V0ZXInLCAnbmdGaWxlVXBsb2FkJywgJ3dqJ10pXHJcbiAgICAgICAgLmNvbmZpZyhjb25maWcpXHJcbiAgICAgICAgLnJ1bihydW4pO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbmZpZygkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIsICRtZFRoZW1pbmdQcm92aWRlcikge1xyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgLy8gZGVmYXVsdCByb3V0ZVxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvXCIpO1xyXG5cclxuICAgICAgICAvLyBtYWtlIHRyYWlsaW5nIHNsYXNoIGluIHVybHMgb3B0aW9uYWxcclxuICAgICAgICAkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlci5zdHJpY3RNb2RlKGZhbHNlKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdvdmVydmlldycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy8nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdvdmVydmlldy9tYWluLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ092ZXJ2aWV3Lk1haW5Db250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHsgc2VsZWN0ZWRUYWI6IDAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3VzZXJzJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3VzZXJzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndXNlcnMvbWFpbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2Vycy5NYWluQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7IHNlbGVjdGVkVGFiOiAxIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndXNlcnMuYWRkJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hZGQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndXNlcnMvYWRkLWVkaXQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJzLkFkZEVkaXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3VzZXJzLmVkaXQnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2VkaXQvOl9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd1c2Vycy9hZGQtZWRpdC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVXNlcnMuQWRkRWRpdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAuc3RhdGUoJ2dlbmVyaWMnLCB7XHJcbiAgICAgICAgICAgIHVybDogJy86ZGF0YVR5cGUnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5kYXRhVHlwZSArICcvbWFpbi5odG1sJztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0dlbmVyaWMuTWFpbkNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2dlbmVyaWMuYWRkJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL2FkZCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24gKCRzdGF0ZVBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdGVQYXJhbXMuZGF0YVR5cGUgKyAnL2FkZC1lZGl0Lmh0bWwnO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdHZW5lcmljLkFkZEVkaXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2dlbmVyaWMuZWRpdCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9lZGl0LzpfaWQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uICgkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXRlUGFyYW1zLmRhdGFUeXBlICsgJy9hZGQtZWRpdC5odG1sJztcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnR2VuZXJpYy5BZGRFZGl0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcnVuKCRyb290U2NvcGUsICRodHRwKSB7XHJcbiAgICAgICAgJHJvb3RTY29wZS5hcGlVcmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAxJztcclxuXHJcbiAgICAgICAgJGh0dHAuZ2V0KCcvdG9rZW4nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9ICdCZWFyZXIgJyArIHJlcy5kYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIiRjYWNoZUZhY3RvcnlcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnQ2FjaGUnLCBTZXJ2aWNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXJ2aWNlKCRjYWNoZUZhY3RvcnkpIHtcclxuICAgICAgICByZXR1cm4gJGNhY2hlRmFjdG9yeSgnY2FjaGUnKTtcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIi8qXHJcbiAgICBHZW5lcmljIGRhdGEgc2VydmljZSBmb3IgYWNjZXNzaW5nIGFwaSBhbmQgY2FjaGluZyByZXN1bHRzXHJcbiovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgU2VydmljZS4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHFcIiwgXCJDYWNoZVwiLCBcIlNvY2tldFwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdEYXRhU2VydmljZScsIFNlcnZpY2UpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlcnZpY2UoJHJvb3RTY29wZSwgJGh0dHAsICRxLCBDYWNoZSwgU29ja2V0KSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0eXBlKSB7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLkdldEFsbCA9IEdldEFsbCh0eXBlKTtcclxuICAgICAgICAgICAgc2VydmljZS5HZXRCeUlkID0gR2V0QnlJZCh0eXBlKTtcclxuICAgICAgICAgICAgc2VydmljZS5DcmVhdGUgPSBDcmVhdGUodHlwZSk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuVXBkYXRlID0gVXBkYXRlKHR5cGUpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLkRlbGV0ZSA9IERlbGV0ZSh0eXBlKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gR2V0QWxsKHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFDYWNoZS5nZXQodHlwZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBnZXQgZGF0YSBmcm9tIGFwaVxyXG4gICAgICAgICAgICAgICAgICAgICRodHRwLmdldCgkcm9vdFNjb3BlLmFwaVVybCArICcvJyArIHR5cGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhY2hlIGRhdGEgdGhlbiByZXR1cm5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhY2hlLnB1dCh0eXBlLCByZXMuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlcy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChyZXMuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gZGF0YSBmcm9tIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShDYWNoZS5nZXQodHlwZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIHN1YnNjcmliZSB0byBhbnkgY2hhbmdlcyB0byB0aGlzIHR5cGVcclxuICAgICAgICAgICAgICAgIFNvY2tldC5Pbih0eXBlLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIEdldEFsbCh0eXBlKSgpLnRoZW4oZnVuY3Rpb24gKGl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZGF0YS5hY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBpdGVtIHRvIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChkYXRhLml0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhY2hlLnB1dCh0eXBlLCBpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1cGRhdGVkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaXRlbSBpbiBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IF8uZmluZEluZGV4KGl0ZW1zLCB7IF9pZDogZGF0YS5pdGVtLl9pZCB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zW2luZGV4XSA9IGRhdGEuaXRlbTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWNoZS5wdXQodHlwZSwgaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGVsZXRlZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGl0ZW0gZnJvbSBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gXy53aXRob3V0KGl0ZW1zLCBfLmZpbmRXaGVyZShpdGVtcywgeyBfaWQ6IGRhdGEuX2lkIH0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWNoZS5wdXQodHlwZSwgaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJyb2FkY2FzdCBldmVudCB0byBjb250cm9sbGVycyB0byB1cGRhdGUgdmlld3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KHR5cGUsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEdldEJ5SWQodHlwZSkgeyBcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBHZXRBbGwodHlwZSkoKS50aGVuKGZ1bmN0aW9uIChpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfLmZpbmRXaGVyZShpdGVtcywgeyBfaWQ6IF9pZCB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBDcmVhdGUodHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Bvc3RpbmcnLCAkcm9vdFNjb3BlLmFwaVVybCArICcvJyArIHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2l0ZW0nLCBpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCRyb290U2NvcGUuYXBpVXJsICsgJy8nICsgdHlwZSwgaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlc29sdmUoKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gVXBkYXRlKHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgkcm9vdFNjb3BlLmFwaVVybCArICcvJyArIHR5cGUgKyAnLycgKyBpdGVtLl9pZCwgaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlc29sdmUoKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRGVsZXRlKHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfaWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCRyb290U2NvcGUuYXBpVXJsICsgJy8nICsgdHlwZSArICcvJyArIF9pZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlc29sdmUoKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgU2VydmljZS4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiVXBsb2FkXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0ZpbGVTZXJ2aWNlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZSgkcm9vdFNjb3BlLCAkaHR0cCwgVXBsb2FkKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgc2VydmljZS5VcGxvYWQgPSBVcGxvYWQudXBsb2FkO1xyXG4gICAgICAgIHNlcnZpY2UuRGVsZXRlID0gZGVsZXRlRmlsZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUZpbGUoZmlsZSkge1xyXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJHJvb3RTY29wZS5hcGlVcmwgKyBmaWxlLnBhdGgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiRGF0YVNlcnZpY2VcIiwgXCJUb2FzdFNlcnZpY2VcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignR2VuZXJpYy5BZGRFZGl0Q29udHJvbGxlcicsIENvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgRGF0YVNlcnZpY2UsIFRvYXN0U2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGRhdGFUeXBlID0gJHN0YXRlUGFyYW1zLmRhdGFUeXBlO1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0gRGF0YVNlcnZpY2UoZGF0YVR5cGUpO1xyXG5cclxuICAgICAgICB2bS5pdGVtID0ge307XHJcbiAgICAgICAgdm0uc2F2ZUl0ZW0gPSBzYXZlSXRlbTtcclxuXHJcbiAgICAgICAgaW5pdENvbnRyb2xsZXIoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdENvbnRyb2xsZXIoKSB7XHJcbiAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlLkdldEJ5SWQoJHN0YXRlUGFyYW1zLl9pZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWVwIGNsb25lIGl0ZW0gaW50byB2bS5pdGVtIHRvIHByZXZlbnQgdW5zYXZlZCBjaGFuZ2VzIHN0YXlpbmcgaW4gdGhlIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHZtLml0ZW0sIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGFsZXJ0IGlmIGl0ZW0gaXMgdXBkYXRlZC9kZWxldGVkIGJ5IGFub3RoZXIgdXNlclxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbihkYXRhVHlwZSwgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9pZCA9IGRhdGEuaXRlbSAmJiBkYXRhLml0ZW0uX2lkIHx8IGRhdGEuX2lkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfaWQgPT09IHZtLml0ZW0uX2lkICYmIF9pZCAhPT0gdm0udXBkYXRlZElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5FcnJvcignVGhpcyBpdGVtIHdhcyBqdXN0ICcgKyBkYXRhLmFjdGlvbiArICcgYnkgYW5vdGhlciB1c2VyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmVJdGVtKGl0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5mb3JtLiRpbnZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghaXRlbS5faWQpIHtcclxuICAgICAgICAgICAgICAgIGNyZWF0ZUl0ZW0oKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlSXRlbSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVJdGVtKCkge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5DcmVhdGUoaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdnZW5lcmljJywgeyBkYXRhVHlwZTogZGF0YVR5cGUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5TdWNjZXNzKCdJdGVtIGNyZWF0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlSXRlbSgpIHtcclxuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZWRJZCA9IGl0ZW0uX2lkO1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5VcGRhdGUoaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIGl0ZW0gbGlzdCB2aWV3XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZ2VuZXJpYycsIHsgZGF0YVR5cGU6IGRhdGFUeXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuU3VjY2VzcygnSXRlbSB1cGRhdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5FcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiRGF0YVNlcnZpY2VcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignR2VuZXJpYy5NYWluQ29udHJvbGxlcicsIENvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgRGF0YVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciBkYXRhVHlwZSA9ICRzdGF0ZVBhcmFtcy5kYXRhVHlwZTtcclxuICAgICAgICB2YXIgc2VydmljZSA9IERhdGFTZXJ2aWNlKGRhdGFUeXBlKTtcclxuXHJcbiAgICAgICAgdm0uZGF0YVR5cGUgPSBkYXRhVHlwZTtcclxuICAgICAgICB2bVtkYXRhVHlwZV0gPSBbXTtcclxuICAgICAgICB2bS5kZWxldGVJdGVtID0gZGVsZXRlSXRlbTtcclxuXHJcbiAgICAgICAgaW5pdENvbnRyb2xsZXIoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdENvbnRyb2xsZXIoKSB7XHJcbiAgICAgICAgICAgIGxvYWRJdGVtcygpO1xyXG5cclxuICAgICAgICAgICAgLy8gcmVsb2FkIGl0ZW1zIG9uICdkYXRhVHlwZScgZXZlbnRcclxuICAgICAgICAgICAgJHNjb3BlLiRvbihkYXRhVHlwZSwgbG9hZEl0ZW1zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRJdGVtcygpIHtcclxuICAgICAgICAgICAgc2VydmljZS5HZXRBbGwoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm1bZGF0YVR5cGVdID0gaXRlbXM7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUl0ZW0oX2lkKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuRGVsZXRlKF9pZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIiRyb290U2NvcGVcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnU29ja2V0JywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZSgkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHNvY2tldCA9IGlvLmNvbm5lY3QoJHJvb3RTY29wZS5hcGlVcmwpO1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcbiAgICAgICAgXHJcbiAgICAgICAgc2VydmljZS5PbiA9IE9uO1xyXG4gICAgICAgIHNlcnZpY2UuRW1pdCA9IEVtaXQ7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuc29ja2V0TGlzdGVuZXJzID0gW107XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBPbihldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGlmICghXy5jb250YWlucygkcm9vdFNjb3BlLnNvY2tldExpc3RlbmVycywgZXZlbnROYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zb2NrZXRMaXN0ZW5lcnMucHVzaChldmVudE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBFbWl0KGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoZXZlbnROYW1lLCBkYXRhLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkbWRUb2FzdFwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdUb2FzdFNlcnZpY2UnLCBTZXJ2aWNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXJ2aWNlKCRtZFRvYXN0KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgc2VydmljZS5TdWNjZXNzID0gRmxhc2goJ3N1Y2Nlc3MnKTtcclxuICAgICAgICBzZXJ2aWNlLkVycm9yID0gRmxhc2goJ2Vycm9yJyk7XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBGbGFzaCh0eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgJG1kVG9hc3Quc2hvdyh7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogQ29udHJvbGxlcixcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd0b2FzdC0nICsgdHlwZSArICctdGVtcGxhdGUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgaGlkZURlbGF5OiA2MDAwLFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gQ29udHJvbGxlcigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gbWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jbG9zZSA9ICRtZFRvYXN0LmhpZGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdUYWJzQ29udHJvbGxlcicsIENvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZtLnNlbGVjdGVkVGFiID0gMDtcclxuICAgICAgICB2bS50YWJzID0gW1xyXG4gICAgICAgICAgICB7IG5hbWU6ICdPdmVydmlldycsIHBhdGg6ICcvJyB9LFxyXG4gICAgICAgICAgICB7IG5hbWU6ICdVc2VycycsIHBhdGg6ICcvdXNlcnMnIH0sXHJcbiAgICAgICAgICAgIHsgbmFtZTogJ1NlcnZpY2VzJywgcGF0aDogJy9zZXJ2aWNlcycgfSxcclxuICAgICAgICAgICAgeyBuYW1lOiAnU3RhZmYnLCBwYXRoOiAnL3N0YWZmJyB9LFxyXG4gICAgICAgICAgICB7IG5hbWU6ICdOZXdzJywgcGF0aDogJy9uZXdzJyB9LFxyXG4gICAgICAgICAgICB7IG5hbWU6ICdFdmVudHMnLCBwYXRoOiAnL2V2ZW50cycgfSxcclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykge1xyXG4gICAgICAgICAgICBpZiAodG9TdGF0ZS5kYXRhICYmIHRvU3RhdGUuZGF0YS5zZWxlY3RlZFRhYikge1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRUYWIgPSB0b1N0YXRlLmRhdGEuc2VsZWN0ZWRUYWI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodG9QYXJhbXMuZGF0YVR5cGUpIHtcclxuICAgICAgICAgICAgICAgIF8uZmluZCh2bS50YWJzLCBmdW5jdGlvbiAodGFiLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b1BhcmFtcy5kYXRhVHlwZSA9PT0gdGFiLm5hbWUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFRhYiA9IGluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ092ZXJ2aWV3Lk1haW5Db250cm9sbGVyJywgQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gQ29udHJvbGxlcigpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIkRhdGFTZXJ2aWNlXCIsIFwiVG9hc3RTZXJ2aWNlXCIsIFwiRmlsZVNlcnZpY2VcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignVXNlcnMuQWRkRWRpdENvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsIERhdGFTZXJ2aWNlLCBUb2FzdFNlcnZpY2UsIEZpbGVTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2YXIgVXNlclNlcnZpY2UgPSBEYXRhU2VydmljZSgndXNlcnMnKTtcclxuXHJcbiAgICAgICAgdm0udGl0bGUgPSAnQWRkIFVzZXInO1xyXG4gICAgICAgIHZtLnVzZXIgPSB7fTtcclxuICAgICAgICB2bS5zYXZlVXNlciA9IHNhdmVVc2VyO1xyXG4gICAgICAgIHZtLnJlbW92ZUZpbGUgPSByZW1vdmVGaWxlO1xyXG5cclxuICAgICAgICBpbml0Q29udHJvbGxlcigpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbml0Q29udHJvbGxlcigpIHtcclxuICAgICAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5faWQpIHtcclxuICAgICAgICAgICAgICAgIHZtLnRpdGxlID0gJ0VkaXQgVXNlcic7XHJcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5HZXRCeUlkKCRzdGF0ZVBhcmFtcy5faWQpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVlcCBjbG9uZSB1c2VyIGludG8gdm0udXNlciB0byBwcmV2ZW50IHVuc2F2ZWQgY2hhbmdlcyBzdGF5aW5nIGluIHRoZSBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCB2bS51c2VyLCB1c2VyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBhbGVydCBpZiB1c2VyIGlzIHVwZGF0ZWQvZGVsZXRlZCBieSBhbm90aGVyIHVzZXJcclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oJ3VzZXJzJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9pZCA9IGRhdGEuaXRlbSAmJiBkYXRhLml0ZW0uX2lkIHx8IGRhdGEuX2lkO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfaWQgPT09IHZtLnVzZXIuX2lkICYmIF9pZCAhPT0gdm0udXBkYXRlZElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5FcnJvcignVGhpcyB1c2VyIHdhcyBqdXN0ICcgKyBkYXRhLmFjdGlvbiArICcgYnkgYW5vdGhlciB1c2VyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ2ZpbGVzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdXBsb2FkRmlsZXMoJHNjb3BlLmZpbGVzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBhbnkgdW5zYXZlZCAvIG9ycGhhbmVkIGZpbGVzXHJcbiAgICAgICAgICAgICAgICBpZiAoIXZtLnNhdmVkICYmIHZtLnVzZXIuZmlsZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdW5zYXZlZEZpbGVzID0gXy5maWx0ZXIodm0udXNlci5maWxlcywgZnVuY3Rpb24gKGZpbGUpIHsgcmV0dXJuICFmaWxlLnNhdmVkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIF8uZWFjaCh1bnNhdmVkRmlsZXMsIGZ1bmN0aW9uIChmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbGVTZXJ2aWNlLkRlbGV0ZShmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmVVc2VyKHVzZXIpIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS51c2VyRm9ybS4kaW52YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIXVzZXIuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICBjcmVhdGVVc2VyKClcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVVzZXIoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNlcigpIHtcclxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkNyZWF0ZSh1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2F2ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3VzZXJzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5TdWNjZXNzKCdVc2VyIGNyZWF0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVXNlcigpIHtcclxuICAgICAgICAgICAgICAgIHZtLnVwZGF0ZWRJZCA9IHVzZXIuX2lkO1xyXG4gICAgICAgICAgICAgICAgVXNlclNlcnZpY2UuVXBkYXRlKHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zYXZlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgYW55IGZpbGVzIGZsYWdnZWQgdG8gYmUgZGVsZXRlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uZmlsZXNUb0RlbGV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHZtLmZpbGVzVG9EZWxldGUsIGZ1bmN0aW9uIChmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsZVNlcnZpY2UuRGVsZXRlKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHRvIHVzZXJzIHZpZXdcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd1c2VycycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuU3VjY2VzcygnVXNlciB1cGRhdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5FcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZEZpbGVzKGZpbGVzKSB7XHJcbiAgICAgICAgICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXIuZmlsZXMgPSB2bS51c2VyLmZpbGVzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgdm0uZmFpbGVkVXBsb2FkcyA9IHZtLmZhaWxlZFVwbG9hZHMgfHwgW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBmaWxlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLnByb2dyZXNzID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGZpbGUgaWYgaXQncyBhbHJlYWR5IGluIHRoZSBsaXN0IHRvIHByZXZlbnQgb3JwaGFuZWQgZmlsZXMgb24gdGhlIHNlcnZlclxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBleGlzdGluZ0ZpbGUgPSBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCB7IG5hbWU6IGZpbGUubmFtZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdGaWxlKSByZW1vdmVGaWxlKGV4aXN0aW5nRmlsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBmaWxlIHRvIHRoZSBsaXN0XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlci5maWxlcy5wdXNoKF8uY2xvbmUoZmlsZSkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyB1cGxvYWQgZmlsZSB0byBzZXJ2ZXJcclxuICAgICAgICAgICAgICAgICAgICBGaWxlU2VydmljZS5VcGxvYWQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAkc2NvcGUuYXBpVXJsICsgJy91cGxvYWRzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IGZpbGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnByb2dyZXNzKGZ1bmN0aW9uIChldnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgeyBuYW1lOiBldnQuY29uZmlnLmZpbGUubmFtZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZmlsZS5wYXRoKSB7IC8vIHBhdGggaXMgc2V0IG9uIHN1Y2Nlc3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnByb2dyZXNzID0gcGFyc2VJbnQoMTAwLjAgKiBldnQubG9hZGVkIC8gZXZ0LnRvdGFsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IF8uZmluZFdoZXJlKHZtLnVzZXIuZmlsZXMsIHsgbmFtZTogY29uZmlnLmZpbGUubmFtZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBmaWxlLnByb2dyZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wYXRoID0gJy91cGxvYWRzLycgKyBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IF8uZmluZFdoZXJlKHZtLnVzZXIuZmlsZXMsIHsgbmFtZTogY29uZmlnLmZpbGUubmFtZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXIuZmlsZXMgPSBfLndpdGhvdXQodm0udXNlci5maWxlcywgXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgZmlsZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5lcnJvciA9IHN0YXR1cyArIFwiIFwiICsgZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZhaWxlZFVwbG9hZHMucHVzaChmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlRmlsZShmaWxlKSB7XHJcbiAgICAgICAgICAgIHZtLnVzZXIuZmlsZXMgPSBfLndpdGhvdXQodm0udXNlci5maWxlcywgXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgeyBuYW1lOiBmaWxlLm5hbWUgfSkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFmaWxlLnNhdmVkKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBmaWxlIG5vdCBsaW5rZWQgdG8gdXNlciBzbyBkZWxldGUgbm93XHJcbiAgICAgICAgICAgICAgICBGaWxlU2VydmljZS5EZWxldGUoZmlsZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBmaWxlIGxpbmtlZCB0byB1c2VyIHNvIGZsYWcgdG8gYmUgZGVsZXRlZCBvbiBzYXZlXHJcbiAgICAgICAgICAgICAgICB2bS5maWxlc1RvRGVsZXRlID0gdm0uZmlsZXNUb0RlbGV0ZSB8fCBbXTtcclxuICAgICAgICAgICAgICAgIHZtLmZpbGVzVG9EZWxldGUucHVzaChmaWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCJEYXRhU2VydmljZVwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdVc2Vycy5NYWluQ29udHJvbGxlcicsIENvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlLCBEYXRhU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIFVzZXJTZXJ2aWNlID0gRGF0YVNlcnZpY2UoJ3VzZXJzJyk7XHJcblxyXG4gICAgICAgIHZtLnVzZXJzID0gW107XHJcbiAgICAgICAgdm0uZGVsZXRlVXNlciA9IGRlbGV0ZVVzZXI7XHJcblxyXG4gICAgICAgIGluaXRDb250cm9sbGVyKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXRDb250cm9sbGVyKCkge1xyXG4gICAgICAgICAgICBsb2FkVXNlcnMoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlbG9hZCB1c2VycyBvbiAndXNlcnMnIGV2ZW50XHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJ3VzZXJzJywgbG9hZFVzZXJzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRVc2VycygpIHtcclxuICAgICAgICAgICAgVXNlclNlcnZpY2UuR2V0QWxsKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh1c2Vycykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzID0gdXNlcnM7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZVVzZXIoX2lkKSB7XHJcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkRlbGV0ZShfaWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
