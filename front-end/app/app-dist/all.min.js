!function(){"use strict";function e(e,t,r,l,o){e.html5Mode(!0),r.otherwise("/"),l.strictMode(!1),t.state("overview",{url:"/",templateUrl:"overview/main.html",controller:"Overview.MainController",controllerAs:"vm",data:{selectedTab:0}}).state("users",{url:"/users",templateUrl:"users/main.html",controller:"Users.MainController",controllerAs:"vm",data:{selectedTab:1}}).state("users.add",{url:"/add",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"}).state("users.edit",{url:"/edit/:_id",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"}).state("generic",{url:"/:dataType",templateUrl:function(e){return e.dataType+"/main.html"},controller:"Generic.MainController",controllerAs:"vm"}).state("generic.add",{url:"/add",templateUrl:function(e){return e.dataType+"/add-edit.html"},controller:"Generic.AddEditController",controllerAs:"vm"}).state("generic.edit",{url:"/edit/:_id",templateUrl:function(e){return e.dataType+"/add-edit.html"},controller:"Generic.AddEditController",controllerAs:"vm"})}function t(e,t){e.apiUrl="http://localhost:3001",t.get("/token").then(function(e){t.defaults.headers.common.Authorization="Bearer "+e.data})}e.$inject=["$locationProvider","$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$mdThemingProvider"],t.$inject=["$rootScope","$http"],angular.module("app",["ngMaterial","md.data.table","ngAnimate","ngMessages","ui.router","ngFileUpload"]).config(e).run(t)}();
!function(){"use strict";function c(c){return c("cache")}c.$inject=["$cacheFactory"],angular.module("app").factory("Cache",c)}();
!function(){"use strict";function t(t,e,n,r,i){function c(o){return function(){var u=n.defer();return r.get(o)?u.resolve(r.get(o)):e.get(t.apiUrl+"/"+o).then(function(t){r.put(o,t.data),u.resolve(t.data)})["catch"](function(t){u.reject(t.data)}),i.On(o,function(e){c(o)().then(function(n){switch(e.action){case"created":n.push(e.item),r.put(o,n);break;case"updated":var i=_.findIndex(n,{_id:e.item._id});n[i]=e.item,r.put(o,n);break;case"deleted":n=_.without(n,_.findWhere(n,{_id:e._id})),r.put(o,n)}t.$broadcast(o,e)})}),u.promise}}function o(t){return function(e){return c(t)().then(function(t){return _.findWhere(t,{_id:e})})}}function u(r){return function(i){var c=n.defer();return console.log("posting",t.apiUrl+"/"+r),console.log("item",i),e.post(t.apiUrl+"/"+r,i).then(function(t){c.resolve()})["catch"](function(t){c.reject(t.data)}),c.promise}}function a(r){return function(i){var c=n.defer();return e.put(t.apiUrl+"/"+r+"/"+i._id,i).then(function(t){c.resolve()})["catch"](function(t){c.reject(t.data)}),c.promise}}function f(r){return function(i){var c=n.defer();return e["delete"](t.apiUrl+"/"+r+"/"+i).then(function(t){c.resolve()})["catch"](function(t){c.reject(t.data)}),c.promise}}return function(t){var e={};return e.GetAll=c(t),e.GetById=o(t),e.Create=u(t),e.Update=a(t),e.Delete=f(t),e}}t.$inject=["$rootScope","$http","$q","Cache","Socket"],angular.module("app").factory("DataService",t)}();
!function(){"use strict";function e(e,t,o){function a(o){t["delete"](e.apiUrl+o.path)}var l={};return l.Upload=o.upload,l.Delete=a,l}e.$inject=["$rootScope","$http","Upload"],angular.module("app").factory("FileService",e)}();
!function(){"use strict";function t(t,e,n,i,a){function c(){n._id&&(u.GetById(n._id).then(function(t){$.extend(!0,o.item,t)}),t.$on(r,function(t,e){var n=e.item&&e.item._id||e._id;n===o.item._id&&n!==o.updatedId&&a.Error("This item was just "+e.action+" by another user")}))}function d(n){function i(){u.Create(n).then(function(){o.saved=!0,e.go("generic",{dataType:r}),a.Success("Item created")})["catch"](function(t){a.Error(t)})}function c(){o.updatedId=n._id,u.Update(n).then(function(){o.saved=!0,e.go("generic",{dataType:r}),a.Success("Item updated")})["catch"](function(t){a.Error(t)})}t.form.$invalid||(n._id?c():i())}var o=this,r=n.dataType,u=i(r);o.item={},o.saveItem=d,c()}t.$inject=["$scope","$state","$stateParams","DataService","ToastService"],angular.module("app").controller("Generic.AddEditController",t)}();
!function(){"use strict";function t(t,e,n,a){function o(){c(),t.$on(r,c)}function c(){u.GetAll().then(function(t){l[r]=t})}function i(t){u.Delete(t)}var l=this,r=n.dataType,u=a(r);l.dataType=r,l[r]=[],l.deleteItem=i,o()}t.$inject=["$scope","$state","$stateParams","DataService"],angular.module("app").controller("Generic.MainController",t)}();
!function(){"use strict";function n(n){function t(t,o){_.contains(n.socketListeners,t)||(n.socketListeners.push(t),c.on(t,function(){var t=arguments;n.$apply(function(){o.apply(c,t)})}))}function o(t,o,e){c.emit(t,o,function(){var t=arguments;n.$apply(function(){e&&e.apply(c,t)})})}var c=io.connect(n.apiUrl),e={};return e.On=t,e.Emit=o,n.socketListeners=[],e}n.$inject=["$rootScope"],angular.module("app").factory("Socket",n)}();
!function(){"use strict";function e(e){function t(t){return function(r){function o(){var t=this;t.message=r,t.close=e.hide}e.show({controller:o,controllerAs:"vm",templateUrl:"toast-"+t+"-template.html",hideDelay:6e3})}}var r={};return r.Success=t("success"),r.Error=t("error"),r}e.$inject=["$mdToast"],angular.module("app").factory("ToastService",e)}();
!function(){"use strict";function e(e){var a=this;a.selectedTab=0,a.tabs=[{name:"Overview",path:"/"},{name:"Users",path:"/users"},{name:"Services",path:"/services"},{name:"Staff",path:"/staff"},{name:"News",path:"/news"},{name:"Events",path:"/events"}],e.$on("$stateChangeSuccess",function(e,t,s,n,c){t.data&&t.data.selectedTab?a.selectedTab=t.data.selectedTab:s.dataType&&_.find(a.tabs,function(e,t){s.dataType===e.name.toLowerCase()&&(a.selectedTab=t)})})}e.$inject=["$rootScope"],angular.module("app").controller("TabsController",e)}();
!function(){"use strict";function n(){}angular.module("app").controller("Overview.MainController",n)}();
!function(){"use strict";function e(e,s,r,i,t,n){function u(){r._id&&(f.title="Edit User",d.GetById(r._id).then(function(e){$.extend(!0,f.user,e)}),e.$on("users",function(e,s){var r=s.item&&s.item._id||s._id;r===f.user._id&&r!==f.updatedId&&t.Error("This user was just "+s.action+" by another user")})),e.$watch("files",function(){o(e.files)}),e.$on("$destroy",function(){if(!f.saved&&f.user.files){var e=_.filter(f.user.files,function(e){return!e.saved});_.each(e,function(e){n.Delete(e)})}})}function a(r){function i(){d.Create(r).then(function(){f.saved=!0,s.go("users"),t.Success("User created")})["catch"](function(e){t.Error(e)})}function u(){f.updatedId=r._id,d.Update(r).then(function(){f.saved=!0,f.filesToDelete&&_.each(f.filesToDelete,function(e){n.Delete(e)}),s.go("users"),t.Success("User updated")})["catch"](function(e){t.Error(e)})}e.userForm.$invalid||(r._id?u():i())}function o(s){if(s&&s.length){f.user.files=f.user.files||[],f.failedUploads=f.failedUploads||[];for(var r=0;r<s.length;r++){var i=s[r];i.progress=0;var t=_.findWhere(f.user.files,{name:i.name});t&&l(t),f.user.files.push(_.clone(i)),n.Upload({url:e.apiUrl+"/uploads",file:i}).progress(function(e){var s=_.findWhere(f.user.files,{name:e.config.file.name});s.path||(s.progress=parseInt(100*e.loaded/e.total))}).success(function(e,s,r,i){var t=_.findWhere(f.user.files,{name:i.file.name});delete t.progress,t.path="/uploads/"+e}).error(function(e,s,r,i){var t=_.findWhere(f.user.files,{name:i.file.name});f.user.files=_.without(f.user.files,_.findWhere(f.user.files,t)),t.error=s+" "+e,f.failedUploads.push(t)})}}}function l(e){f.user.files=_.without(f.user.files,_.findWhere(f.user.files,{name:e.name})),e.saved?(f.filesToDelete=f.filesToDelete||[],f.filesToDelete.push(e)):n.Delete(e)}var f=this,d=i("users");f.title="Add User",f.user={},f.saveUser=a,f.removeFile=l,u()}e.$inject=["$scope","$state","$stateParams","DataService","ToastService","FileService"],angular.module("app").controller("Users.AddEditController",e)}();
!function(){"use strict";function e(e,n){function t(){s(),e.$on("users",s)}function s(){u.GetAll().then(function(e){o.users=e})}function r(e){u.Delete(e)}var o=this,u=n("users");o.users=[],o.deleteUser=r,t()}e.$inject=["$scope","DataService"],angular.module("app").controller("Users.MainController",e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC1zZXJ2aWNlcy9jYWNoZS5qcyIsImFwcC1zZXJ2aWNlcy9kYXRhLnNlcnZpY2UuanMiLCJhcHAtc2VydmljZXMvZmlsZS5zZXJ2aWNlLmpzIiwiYXBwLXNlcnZpY2VzL2dlbmVyaWMuYWRkLWVkaXQuY29udHJvbGxlci5qcyIsImFwcC1zZXJ2aWNlcy9nZW5lcmljLm1haW4uY29udHJvbGxlci5qcyIsImFwcC1zZXJ2aWNlcy9zb2NrZXQuanMiLCJhcHAtc2VydmljZXMvdG9hc3Quc2VydmljZS5qcyIsImxheW91dC90YWJzLmNvbnRyb2xsZXIuanMiLCJvdmVydmlldy9tYWluLmNvbnRyb2xsZXIuanMiLCJ1c2Vycy9hZGQtZWRpdC5jb250cm9sbGVyLmpzIiwidXNlcnMvbWFpbi5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInN0cmljdE1vZGUiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsImRhdGEiLCJzZWxlY3RlZFRhYiIsIiRzdGF0ZVBhcmFtcyIsImRhdGFUeXBlIiwicnVuIiwiJHJvb3RTY29wZSIsIiRodHRwIiwiYXBpVXJsIiwiZ2V0IiwidGhlbiIsInJlcyIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsIiRpbmplY3QiLCJhbmd1bGFyIiwibW9kdWxlIiwiU2VydmljZSIsIiRjYWNoZUZhY3RvcnkiLCJmYWN0b3J5IiwiJHEiLCJDYWNoZSIsIlNvY2tldCIsIkdldEFsbCIsInR5cGUiLCJkZWZlcnJlZCIsImRlZmVyIiwicmVzb2x2ZSIsInB1dCIsInJlamVjdCIsIk9uIiwiaXRlbXMiLCJhY3Rpb24iLCJwdXNoIiwiaXRlbSIsImluZGV4IiwiXyIsImZpbmRJbmRleCIsIl9pZCIsIndpdGhvdXQiLCJmaW5kV2hlcmUiLCIkYnJvYWRjYXN0IiwicHJvbWlzZSIsIkdldEJ5SWQiLCJDcmVhdGUiLCJjb25zb2xlIiwibG9nIiwicG9zdCIsIlVwZGF0ZSIsIkRlbGV0ZSIsInNlcnZpY2UiLCJVcGxvYWQiLCJkZWxldGVGaWxlIiwiZmlsZSIsInBhdGgiLCJ1cGxvYWQiLCJDb250cm9sbGVyIiwiJHNjb3BlIiwiJHN0YXRlIiwiRGF0YVNlcnZpY2UiLCJUb2FzdFNlcnZpY2UiLCJpbml0Q29udHJvbGxlciIsIiQiLCJleHRlbmQiLCJ2bSIsIiRvbiIsImV2ZW50IiwidXBkYXRlZElkIiwiRXJyb3IiLCJzYXZlSXRlbSIsImNyZWF0ZUl0ZW0iLCJzYXZlZCIsImdvIiwiU3VjY2VzcyIsImVycm9yIiwidXBkYXRlSXRlbSIsImZvcm0iLCIkaW52YWxpZCIsInRoaXMiLCJsb2FkSXRlbXMiLCJkZWxldGVJdGVtIiwiZXZlbnROYW1lIiwiY2FsbGJhY2siLCJjb250YWlucyIsInNvY2tldExpc3RlbmVycyIsInNvY2tldCIsIm9uIiwiYXJncyIsImFyZ3VtZW50cyIsIiRhcHBseSIsImFwcGx5IiwiRW1pdCIsImVtaXQiLCJpbyIsImNvbm5lY3QiLCIkbWRUb2FzdCIsIkZsYXNoIiwibWVzc2FnZSIsImNsb3NlIiwiaGlkZSIsInNob3ciLCJoaWRlRGVsYXkiLCJ0YWJzIiwibmFtZSIsInRvU3RhdGUiLCJ0b1BhcmFtcyIsImZyb21TdGF0ZSIsImZyb21QYXJhbXMiLCJmaW5kIiwidGFiIiwidG9Mb3dlckNhc2UiLCJGaWxlU2VydmljZSIsInRpdGxlIiwiVXNlclNlcnZpY2UiLCJ1c2VyIiwiJHdhdGNoIiwidXBsb2FkRmlsZXMiLCJmaWxlcyIsInVuc2F2ZWRGaWxlcyIsImZpbHRlciIsImVhY2giLCJzYXZlVXNlciIsImNyZWF0ZVVzZXIiLCJ1cGRhdGVVc2VyIiwiZmlsZXNUb0RlbGV0ZSIsInVzZXJGb3JtIiwibGVuZ3RoIiwiZmFpbGVkVXBsb2FkcyIsImkiLCJwcm9ncmVzcyIsImV4aXN0aW5nRmlsZSIsInJlbW92ZUZpbGUiLCJjbG9uZSIsImV2dCIsInBhcnNlSW50IiwibG9hZGVkIiwidG90YWwiLCJzdWNjZXNzIiwic3RhdHVzIiwibG9hZFVzZXJzIiwidXNlcnMiLCJkZWxldGVVc2VyIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNJLFlBU0EsU0FBU0EsR0FBT0MsRUFBbUJDLEVBQWdCQyxFQUFvQkMsRUFBNEJDLEdBQy9GSixFQUFrQkssV0FBVSxHQUc1QkgsRUFBbUJJLFVBQVUsS0FHN0JILEVBQTJCSSxZQUFXLEdBRXRDTixFQUNLTyxNQUFNLFlBQ0hDLElBQUssSUFDTEMsWUFBYSxxQkFDYkMsV0FBWSwwQkFDWkMsYUFBYyxLQUNkQyxNQUFRQyxZQUFhLEtBRXhCTixNQUFNLFNBQ0hDLElBQUssU0FDTEMsWUFBYSxrQkFDYkMsV0FBWSx1QkFDWkMsYUFBYyxLQUNkQyxNQUFRQyxZQUFhLEtBRXBCTixNQUFNLGFBQ0hDLElBQUssT0FDTEMsWUFBYSxzQkFDYkMsV0FBWSwwQkFDWkMsYUFBYyxPQUVqQkosTUFBTSxjQUNIQyxJQUFLLGFBQ0xDLFlBQWEsc0JBQ2JDLFdBQVksMEJBQ1pDLGFBQWMsT0FFekJKLE1BQU0sV0FDSEMsSUFBSyxhQUNMQyxZQUFhLFNBQVVLLEdBQ25CLE1BQU9BLEdBQWFDLFNBQVcsY0FFbkNMLFdBQVkseUJBQ1pDLGFBQWMsT0FFYkosTUFBTSxlQUNIQyxJQUFLLE9BQ0xDLFlBQWEsU0FBVUssR0FDbkIsTUFBT0EsR0FBYUMsU0FBVyxrQkFFbkNMLFdBQVksNEJBQ1pDLGFBQWMsT0FFakJKLE1BQU0sZ0JBQ0hDLElBQUssYUFDTEMsWUFBYSxTQUFVSyxHQUNuQixNQUFPQSxHQUFhQyxTQUFXLGtCQUVuQ0wsV0FBWSw0QkFDWkMsYUFBYyxPQUkxQixRQUFTSyxHQUFJQyxFQUFZQyxHQUNyQkQsRUFBV0UsT0FBUyx3QkFFcEJELEVBQU1FLElBQUksVUFBVUMsS0FBSyxTQUFV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R2tELEtBQUtHLE9BQVNkLEtBQU1sRCxFQUFLa0QsUUFFNUVsRCxFQUFLa0IsT0FLTlAsRUFBRzRELGNBQWdCNUQsRUFBRzRELGtCQUN0QjVELEVBQUc0RCxjQUFjM0YsS0FBS29CLElBSnRCMEQsRUFBWTlELE9BQU9JLEdBdkkzQixHQUFJVyxHQUFLYyxLQUNMbUMsRUFBY3RELEVBQVksUUFFOUJLLEdBQUdnRCxNQUFRLFdBQ1hoRCxFQUFHa0QsUUFDSGxELEVBQUd5RCxTQUFXQSxFQUNkekQsRUFBR21FLFdBQWFBLEVBRWhCdEUsSUFkSkwsRUFBVzFDLFNBQVcsU0FBVSxTQUFVLGVBQWdCLGNBQWUsZUFBZ0IsZUFDekZDLFFBQ0tDLE9BQU8sT0FDUGxCLFdBQVcsMEJBQTJCMEQ7Q0NOL0MsV0FDSSxZQU9BLFNBQVNBLEdBQVdDLEVBQVFFLEdBU3hCLFFBQVNFLEtBQ0w4RSxJQUdBbEYsRUFBT1EsSUFBSSxRQUFTMEUsR0FHeEIsUUFBU0EsS0FDTDFCLEVBQVkxRixTQUNQZCxLQUFLLFNBQVVtSSxHQUNaNUUsRUFBRzRFLE1BQVFBLElBSXZCLFFBQVNDLEdBQVd2RyxHQUNoQjJFLEVBQVloRSxPQUFPWCxHQXZCdkIsR0FBSTBCLEdBQUtjLEtBQ0xtQyxFQUFjdEQsRUFBWSxRQUU5QkssR0FBRzRFLFNBQ0g1RSxFQUFHNkUsV0FBYUEsRUFFaEJoRixJQVpKTCxFQUFXMUMsU0FBVyxTQUFVLGVBQ2hDQyxRQUNLQyxPQUFPLE9BQ1BsQixXQUFXLHVCQUF3QjBEIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGNvbmZpZy4kaW5qZWN0ID0gW1wiJGxvY2F0aW9uUHJvdmlkZXJcIiwgXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBcIiR1cmxNYXRjaGVyRmFjdG9yeVByb3ZpZGVyXCIsIFwiJG1kVGhlbWluZ1Byb3ZpZGVyXCJdO1xyXG4gICAgcnVuLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJywgWyduZ01hdGVyaWFsJywgJ21kLmRhdGEudGFibGUnLCAnbmdBbmltYXRlJywgJ25nTWVzc2FnZXMnLCAndWkucm91dGVyJywgJ25nRmlsZVVwbG9hZCddKVxyXG4gICAgICAgIC5jb25maWcoY29uZmlnKVxyXG4gICAgICAgIC5ydW4ocnVuKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb25maWcoJGxvY2F0aW9uUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIsICR1cmxNYXRjaGVyRmFjdG9yeVByb3ZpZGVyLCAkbWRUaGVtaW5nUHJvdmlkZXIpIHtcclxuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIC8vIGRlZmF1bHQgcm91dGVcclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcclxuXHJcbiAgICAgICAgLy8gbWFrZSB0cmFpbGluZyBzbGFzaCBpbiB1cmxzIG9wdGlvbmFsXHJcbiAgICAgICAgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIuc3RyaWN0TW9kZShmYWxzZSk7XHJcblxyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnb3ZlcnZpZXcnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnb3ZlcnZpZXcvbWFpbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdPdmVydmlldy5NYWluQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7IHNlbGVjdGVkVGFiOiAwIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCd1c2VycycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy91c2VycycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3VzZXJzL21haW4uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVXNlcnMuTWFpbkNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogeyBzZWxlY3RlZFRhYjogMSB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3VzZXJzLmFkZCcsIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYWRkJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3VzZXJzL2FkZC1lZGl0Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2Vycy5BZGRFZGl0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd1c2Vycy5lZGl0Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9lZGl0LzpfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndXNlcnMvYWRkLWVkaXQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJzLkFkZEVkaXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdnZW5lcmljJywge1xyXG4gICAgICAgICAgICB1cmw6ICcvOmRhdGFUeXBlJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uICgkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkc3RhdGVQYXJhbXMuZGF0YVR5cGUgKyAnL21haW4uaHRtbCc7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdHZW5lcmljLk1haW5Db250cm9sbGVyJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdnZW5lcmljLmFkZCcsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hZGQnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uICgkc3RhdGVQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXRlUGFyYW1zLmRhdGFUeXBlICsgJy9hZGQtZWRpdC5odG1sJztcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnR2VuZXJpYy5BZGRFZGl0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdnZW5lcmljLmVkaXQnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvZWRpdC86X2lkJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbiAoJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5kYXRhVHlwZSArICcvYWRkLWVkaXQuaHRtbCc7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0dlbmVyaWMuQWRkRWRpdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJ1bigkcm9vdFNjb3BlLCAkaHR0cCkge1xyXG4gICAgICAgICRyb290U2NvcGUuYXBpVXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMSc7XHJcblxyXG4gICAgICAgICRodHRwLmdldCgnL3Rva2VuJykudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSAnQmVhcmVyICcgKyByZXMuZGF0YTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkY2FjaGVGYWN0b3J5XCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0NhY2hlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZSgkY2FjaGVGYWN0b3J5KSB7XHJcbiAgICAgICAgcmV0dXJuICRjYWNoZUZhY3RvcnkoJ2NhY2hlJyk7XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIvKlxyXG4gICAgR2VuZXJpYyBkYXRhIHNlcnZpY2UgZm9yIGFjY2Vzc2luZyBhcGkgYW5kIGNhY2hpbmcgcmVzdWx0c1xyXG4qL1xyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRxXCIsIFwiQ2FjaGVcIiwgXCJTb2NrZXRcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnRGF0YVNlcnZpY2UnLCBTZXJ2aWNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXJ2aWNlKCRyb290U2NvcGUsICRodHRwLCAkcSwgQ2FjaGUsIFNvY2tldCkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZSA9IHt9O1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5HZXRBbGwgPSBHZXRBbGwodHlwZSk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuR2V0QnlJZCA9IEdldEJ5SWQodHlwZSk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuQ3JlYXRlID0gQ3JlYXRlKHR5cGUpO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLlVwZGF0ZSA9IFVwZGF0ZSh0eXBlKTtcclxuICAgICAgICAgICAgc2VydmljZS5EZWxldGUgPSBEZWxldGUodHlwZSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEdldEFsbCh0eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghQ2FjaGUuZ2V0KHR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGRhdGEgZnJvbSBhcGlcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJHJvb3RTY29wZS5hcGlVcmwgKyAnLycgKyB0eXBlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWNoZSBkYXRhIHRoZW4gcmV0dXJuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWNoZS5wdXQodHlwZSwgcmVzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIGRhdGEgZnJvbSBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoQ2FjaGUuZ2V0KHR5cGUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzdWJzY3JpYmUgdG8gYW55IGNoYW5nZXMgdG8gdGhpcyB0eXBlXHJcbiAgICAgICAgICAgICAgICBTb2NrZXQuT24odHlwZSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBHZXRBbGwodHlwZSkoKS50aGVuKGZ1bmN0aW9uIChpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGRhdGEuYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGVkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgaXRlbSB0byBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goZGF0YS5pdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWNoZS5wdXQodHlwZSwgaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIGl0ZW0gaW4gY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBfLmZpbmRJbmRleChpdGVtcywgeyBfaWQ6IGRhdGEuaXRlbS5faWQgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tpbmRleF0gPSBkYXRhLml0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FjaGUucHV0KHR5cGUsIGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBpdGVtIGZyb20gY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IF8ud2l0aG91dChpdGVtcywgXy5maW5kV2hlcmUoaXRlbXMsIHsgX2lkOiBkYXRhLl9pZCB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FjaGUucHV0KHR5cGUsIGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBicm9hZGNhc3QgZXZlbnQgdG8gY29udHJvbGxlcnMgdG8gdXBkYXRlIHZpZXdzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCh0eXBlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBHZXRCeUlkKHR5cGUpIHsgXHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX2lkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gR2V0QWxsKHR5cGUpKCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5maW5kV2hlcmUoaXRlbXMsIHsgX2lkOiBfaWQgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ3JlYXRlKHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwb3N0aW5nJywgJHJvb3RTY29wZS5hcGlVcmwgKyAnLycgKyB0eXBlKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdpdGVtJywgaXRlbSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgkcm9vdFNjb3BlLmFwaVVybCArICcvJyArIHR5cGUsIGl0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZXNvbHZlKCk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHsgZGVmZXJyZWQucmVqZWN0KHJlcy5kYXRhKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIFVwZGF0ZSh0eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJHJvb3RTY29wZS5hcGlVcmwgKyAnLycgKyB0eXBlICsgJy8nICsgaXRlbS5faWQsIGl0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZXNvbHZlKCk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHsgZGVmZXJyZWQucmVqZWN0KHJlcy5kYXRhKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIERlbGV0ZSh0eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX2lkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgICRodHRwLmRlbGV0ZSgkcm9vdFNjb3BlLmFwaVVybCArICcvJyArIHR5cGUgKyAnLycgKyBfaWQpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZXNvbHZlKCk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHsgZGVmZXJyZWQucmVqZWN0KHJlcy5kYXRhKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIlVwbG9hZFwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdGaWxlU2VydmljZScsIFNlcnZpY2UpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlcnZpY2UoJHJvb3RTY29wZSwgJGh0dHAsIFVwbG9hZCkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UuVXBsb2FkID0gVXBsb2FkLnVwbG9hZDtcclxuICAgICAgICBzZXJ2aWNlLkRlbGV0ZSA9IGRlbGV0ZUZpbGU7XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWxldGVGaWxlKGZpbGUpIHtcclxuICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCRyb290U2NvcGUuYXBpVXJsICsgZmlsZS5wYXRoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIkRhdGFTZXJ2aWNlXCIsIFwiVG9hc3RTZXJ2aWNlXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0dlbmVyaWMuQWRkRWRpdENvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsIERhdGFTZXJ2aWNlLCBUb2FzdFNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciBkYXRhVHlwZSA9ICRzdGF0ZVBhcmFtcy5kYXRhVHlwZTtcclxuICAgICAgICB2YXIgc2VydmljZSA9IERhdGFTZXJ2aWNlKGRhdGFUeXBlKTtcclxuXHJcbiAgICAgICAgdm0uaXRlbSA9IHt9O1xyXG4gICAgICAgIHZtLnNhdmVJdGVtID0gc2F2ZUl0ZW07XHJcblxyXG4gICAgICAgIGluaXRDb250cm9sbGVyKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXRDb250cm9sbGVyKCkge1xyXG4gICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5HZXRCeUlkKCRzdGF0ZVBhcmFtcy5faWQpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVlcCBjbG9uZSBpdGVtIGludG8gdm0uaXRlbSB0byBwcmV2ZW50IHVuc2F2ZWQgY2hhbmdlcyBzdGF5aW5nIGluIHRoZSBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCB2bS5pdGVtLCBpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBhbGVydCBpZiBpdGVtIGlzIHVwZGF0ZWQvZGVsZXRlZCBieSBhbm90aGVyIHVzZXJcclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oZGF0YVR5cGUsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfaWQgPSBkYXRhLml0ZW0gJiYgZGF0YS5pdGVtLl9pZCB8fCBkYXRhLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX2lkID09PSB2bS5pdGVtLl9pZCAmJiBfaWQgIT09IHZtLnVwZGF0ZWRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuRXJyb3IoJ1RoaXMgaXRlbSB3YXMganVzdCAnICsgZGF0YS5hY3Rpb24gKyAnIGJ5IGFub3RoZXIgdXNlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlSXRlbShpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuZm9ybS4kaW52YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIWl0ZW0uX2lkKSB7XHJcbiAgICAgICAgICAgICAgICBjcmVhdGVJdGVtKClcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZUl0ZW0oKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSXRlbSgpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UuQ3JlYXRlKGl0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zYXZlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZ2VuZXJpYycsIHsgZGF0YVR5cGU6IGRhdGFUeXBlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuU3VjY2VzcygnSXRlbSBjcmVhdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5FcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUl0ZW0oKSB7XHJcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVkSWQgPSBpdGVtLl9pZDtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UuVXBkYXRlKGl0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zYXZlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB0byBpdGVtIGxpc3Qgdmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2dlbmVyaWMnLCB7IGRhdGFUeXBlOiBkYXRhVHlwZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLlN1Y2Nlc3MoJ0l0ZW0gdXBkYXRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIkRhdGFTZXJ2aWNlXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0dlbmVyaWMuTWFpbkNvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsIERhdGFTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2YXIgZGF0YVR5cGUgPSAkc3RhdGVQYXJhbXMuZGF0YVR5cGU7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSBEYXRhU2VydmljZShkYXRhVHlwZSk7XHJcblxyXG4gICAgICAgIHZtLmRhdGFUeXBlID0gZGF0YVR5cGU7XHJcbiAgICAgICAgdm1bZGF0YVR5cGVdID0gW107XHJcbiAgICAgICAgdm0uZGVsZXRlSXRlbSA9IGRlbGV0ZUl0ZW07XHJcblxyXG4gICAgICAgIGluaXRDb250cm9sbGVyKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXRDb250cm9sbGVyKCkge1xyXG4gICAgICAgICAgICBsb2FkSXRlbXMoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlbG9hZCBpdGVtcyBvbiAnZGF0YVR5cGUnIGV2ZW50XHJcbiAgICAgICAgICAgICRzY29wZS4kb24oZGF0YVR5cGUsIGxvYWRJdGVtcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2FkSXRlbXMoKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuR2V0QWxsKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtW2RhdGFUeXBlXSA9IGl0ZW1zO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWxldGVJdGVtKF9pZCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLkRlbGV0ZShfaWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1NvY2tldCcsIFNlcnZpY2UpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlcnZpY2UoJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KCRyb290U2NvcGUuYXBpVXJsKTtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHt9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNlcnZpY2UuT24gPSBPbjtcclxuICAgICAgICBzZXJ2aWNlLkVtaXQgPSBFbWl0O1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLnNvY2tldExpc3RlbmVycyA9IFtdO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gT24oZXZlbnROYW1lLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAoIV8uY29udGFpbnMoJHJvb3RTY29wZS5zb2NrZXRMaXN0ZW5lcnMsIGV2ZW50TmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuc29ja2V0TGlzdGVuZXJzLnB1c2goZXZlbnROYW1lKTtcclxuICAgICAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRW1pdChldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgU2VydmljZS4kaW5qZWN0ID0gW1wiJG1kVG9hc3RcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnVG9hc3RTZXJ2aWNlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZSgkbWRUb2FzdCkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UuU3VjY2VzcyA9IEZsYXNoKCdzdWNjZXNzJyk7XHJcbiAgICAgICAgc2VydmljZS5FcnJvciA9IEZsYXNoKCdlcnJvcicpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRmxhc2godHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICRtZFRvYXN0LnNob3coe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndG9hc3QtJyArIHR5cGUgKyAnLXRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhpZGVEZWxheTogNjAwMCxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IG1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2xvc2UgPSAkbWRUb2FzdC5oaWRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRyb290U2NvcGVcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignVGFic0NvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRyb290U2NvcGUpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5zZWxlY3RlZFRhYiA9IDA7XHJcbiAgICAgICAgdm0udGFicyA9IFtcclxuICAgICAgICAgICAgeyBuYW1lOiAnT3ZlcnZpZXcnLCBwYXRoOiAnLycgfSxcclxuICAgICAgICAgICAgeyBuYW1lOiAnVXNlcnMnLCBwYXRoOiAnL3VzZXJzJyB9LFxyXG4gICAgICAgICAgICB7IG5hbWU6ICdTZXJ2aWNlcycsIHBhdGg6ICcvc2VydmljZXMnIH0sXHJcbiAgICAgICAgICAgIHsgbmFtZTogJ1N0YWZmJywgcGF0aDogJy9zdGFmZicgfSxcclxuICAgICAgICAgICAgeyBuYW1lOiAnTmV3cycsIHBhdGg6ICcvbmV3cycgfSxcclxuICAgICAgICAgICAgeyBuYW1lOiAnRXZlbnRzJywgcGF0aDogJy9ldmVudHMnIH0sXHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHtcclxuICAgICAgICAgICAgaWYgKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEuc2VsZWN0ZWRUYWIpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkVGFiID0gdG9TdGF0ZS5kYXRhLnNlbGVjdGVkVGFiO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRvUGFyYW1zLmRhdGFUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICBfLmZpbmQodm0udGFicywgZnVuY3Rpb24gKHRhYiwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodG9QYXJhbXMuZGF0YVR5cGUgPT09IHRhYi5uYW1lLnRvTG93ZXJDYXNlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRUYWIgPSBpbmRleDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdPdmVydmlldy5NYWluQ29udHJvbGxlcicsIENvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCJEYXRhU2VydmljZVwiLCBcIlRvYXN0U2VydmljZVwiLCBcIkZpbGVTZXJ2aWNlXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1VzZXJzLkFkZEVkaXRDb250cm9sbGVyJywgQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCBEYXRhU2VydmljZSwgVG9hc3RTZXJ2aWNlLCBGaWxlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIFVzZXJTZXJ2aWNlID0gRGF0YVNlcnZpY2UoJ3VzZXJzJyk7XHJcblxyXG4gICAgICAgIHZtLnRpdGxlID0gJ0FkZCBVc2VyJztcclxuICAgICAgICB2bS51c2VyID0ge307XHJcbiAgICAgICAgdm0uc2F2ZVVzZXIgPSBzYXZlVXNlcjtcclxuICAgICAgICB2bS5yZW1vdmVGaWxlID0gcmVtb3ZlRmlsZTtcclxuXHJcbiAgICAgICAgaW5pdENvbnRyb2xsZXIoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdENvbnRyb2xsZXIoKSB7XHJcbiAgICAgICAgICAgIGlmICgkc3RhdGVQYXJhbXMuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICB2bS50aXRsZSA9ICdFZGl0IFVzZXInO1xyXG4gICAgICAgICAgICAgICAgVXNlclNlcnZpY2UuR2V0QnlJZCgkc3RhdGVQYXJhbXMuX2lkKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlZXAgY2xvbmUgdXNlciBpbnRvIHZtLnVzZXIgdG8gcHJldmVudCB1bnNhdmVkIGNoYW5nZXMgc3RheWluZyBpbiB0aGUgY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgdm0udXNlciwgdXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gYWxlcnQgaWYgdXNlciBpcyB1cGRhdGVkL2RlbGV0ZWQgYnkgYW5vdGhlciB1c2VyXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCd1c2VycycsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfaWQgPSBkYXRhLml0ZW0gJiYgZGF0YS5pdGVtLl9pZCB8fCBkYXRhLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX2lkID09PSB2bS51c2VyLl9pZCAmJiBfaWQgIT09IHZtLnVwZGF0ZWRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuRXJyb3IoJ1RoaXMgdXNlciB3YXMganVzdCAnICsgZGF0YS5hY3Rpb24gKyAnIGJ5IGFub3RoZXIgdXNlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCdmaWxlcycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHVwbG9hZEZpbGVzKCRzY29wZS5maWxlcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkZWxldGUgYW55IHVuc2F2ZWQgLyBvcnBoYW5lZCBmaWxlc1xyXG4gICAgICAgICAgICAgICAgaWYgKCF2bS5zYXZlZCAmJiB2bS51c2VyLmZpbGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVuc2F2ZWRGaWxlcyA9IF8uZmlsdGVyKHZtLnVzZXIuZmlsZXMsIGZ1bmN0aW9uIChmaWxlKSB7IHJldHVybiAhZmlsZS5zYXZlZCB9KTtcclxuICAgICAgICAgICAgICAgICAgICBfLmVhY2godW5zYXZlZEZpbGVzLCBmdW5jdGlvbiAoZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBGaWxlU2VydmljZS5EZWxldGUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlVXNlcih1c2VyKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUudXNlckZvcm0uJGludmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF1c2VyLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgY3JlYXRlVXNlcigpXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVVc2VyKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVVzZXIoKSB7XHJcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5DcmVhdGUodXNlcilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd1c2VycycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuU3VjY2VzcygnVXNlciBjcmVhdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5FcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVVzZXIoKSB7XHJcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVkSWQgPSB1c2VyLl9pZDtcclxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLlVwZGF0ZSh1c2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2F2ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlIGFueSBmaWxlcyBmbGFnZ2VkIHRvIGJlIGRlbGV0ZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmZpbGVzVG9EZWxldGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaCh2bS5maWxlc1RvRGVsZXRlLCBmdW5jdGlvbiAoZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGVTZXJ2aWNlLkRlbGV0ZShmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB0byB1c2VycyB2aWV3XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygndXNlcnMnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLlN1Y2Nlc3MoJ1VzZXIgdXBkYXRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGxvYWRGaWxlcyhmaWxlcykge1xyXG4gICAgICAgICAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyLmZpbGVzID0gdm0udXNlci5maWxlcyB8fCBbXTtcclxuICAgICAgICAgICAgICAgIHZtLmZhaWxlZFVwbG9hZHMgPSB2bS5mYWlsZWRVcGxvYWRzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gZmlsZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5wcm9ncmVzcyA9IDA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBmaWxlIGlmIGl0J3MgYWxyZWFkeSBpbiB0aGUgbGlzdCB0byBwcmV2ZW50IG9ycGhhbmVkIGZpbGVzIG9uIHRoZSBzZXJ2ZXJcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXhpc3RpbmdGaWxlID0gXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgeyBuYW1lOiBmaWxlLm5hbWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nRmlsZSkgcmVtb3ZlRmlsZShleGlzdGluZ0ZpbGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgZmlsZSB0byB0aGUgbGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXIuZmlsZXMucHVzaChfLmNsb25lKGZpbGUpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBsb2FkIGZpbGUgdG8gc2VydmVyXHJcbiAgICAgICAgICAgICAgICAgICAgRmlsZVNlcnZpY2UuVXBsb2FkKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJHNjb3BlLmFwaVVybCArICcvdXBsb2FkcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlOiBmaWxlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wcm9ncmVzcyhmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IF8uZmluZFdoZXJlKHZtLnVzZXIuZmlsZXMsIHsgbmFtZTogZXZ0LmNvbmZpZy5maWxlLm5hbWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGUucGF0aCkgeyAvLyBwYXRoIGlzIHNldCBvbiBzdWNjZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5wcm9ncmVzcyA9IHBhcnNlSW50KDEwMC4wICogZXZ0LmxvYWRlZCAvIGV2dC50b3RhbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCB7IG5hbWU6IGNvbmZpZy5maWxlLm5hbWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgZmlsZS5wcm9ncmVzcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucGF0aCA9ICcvdXBsb2Fkcy8nICsgZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCB7IG5hbWU6IGNvbmZpZy5maWxlLm5hbWUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS51c2VyLmZpbGVzID0gXy53aXRob3V0KHZtLnVzZXIuZmlsZXMsIF8uZmluZFdoZXJlKHZtLnVzZXIuZmlsZXMsIGZpbGUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuZXJyb3IgPSBzdGF0dXMgKyBcIiBcIiArIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5mYWlsZWRVcGxvYWRzLnB1c2goZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUZpbGUoZmlsZSkge1xyXG4gICAgICAgICAgICB2bS51c2VyLmZpbGVzID0gXy53aXRob3V0KHZtLnVzZXIuZmlsZXMsIF8uZmluZFdoZXJlKHZtLnVzZXIuZmlsZXMsIHsgbmFtZTogZmlsZS5uYW1lIH0pKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghZmlsZS5zYXZlZCkge1xyXG4gICAgICAgICAgICAgICAgLy8gZmlsZSBub3QgbGlua2VkIHRvIHVzZXIgc28gZGVsZXRlIG5vd1xyXG4gICAgICAgICAgICAgICAgRmlsZVNlcnZpY2UuRGVsZXRlKGZpbGUpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gZmlsZSBsaW5rZWQgdG8gdXNlciBzbyBmbGFnIHRvIGJlIGRlbGV0ZWQgb24gc2F2ZVxyXG4gICAgICAgICAgICAgICAgdm0uZmlsZXNUb0RlbGV0ZSA9IHZtLmZpbGVzVG9EZWxldGUgfHwgW107XHJcbiAgICAgICAgICAgICAgICB2bS5maWxlc1RvRGVsZXRlLnB1c2goZmlsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiRGF0YVNlcnZpY2VcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignVXNlcnMuTWFpbkNvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgRGF0YVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciBVc2VyU2VydmljZSA9IERhdGFTZXJ2aWNlKCd1c2VycycpO1xyXG5cclxuICAgICAgICB2bS51c2VycyA9IFtdO1xyXG4gICAgICAgIHZtLmRlbGV0ZVVzZXIgPSBkZWxldGVVc2VyO1xyXG5cclxuICAgICAgICBpbml0Q29udHJvbGxlcigpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbml0Q29udHJvbGxlcigpIHtcclxuICAgICAgICAgICAgbG9hZFVzZXJzKCk7XHJcblxyXG4gICAgICAgICAgICAvLyByZWxvYWQgdXNlcnMgb24gJ3VzZXJzJyBldmVudFxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCd1c2VycycsIGxvYWRVc2Vycyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2FkVXNlcnMoKSB7XHJcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkdldEFsbCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodXNlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2VycyA9IHVzZXJzO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWxldGVVc2VyKF9pZCkge1xyXG4gICAgICAgICAgICBVc2VyU2VydmljZS5EZWxldGUoX2lkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
