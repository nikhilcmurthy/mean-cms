!function(){"use strict";function e(e,t,r,o,l){e.html5Mode(!0),r.otherwise("/"),o.strictMode(!1),t.state("overview",{url:"/",templateUrl:"overview/main.html",controller:"Overview.MainController",controllerAs:"vm",data:{selectedTab:0}}).state("users",{url:"/users",templateUrl:"users/main.html",controller:"Users.MainController",controllerAs:"vm",data:{selectedTab:1}}).state("users.add",{url:"/add",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"}).state("users.edit",{url:"/edit/:_id",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"})}function t(e,t){e.apiUrl="http://localhost:3001",t.get("/token").then(function(e){t.defaults.headers.common.Authorization="Bearer "+e.data})}angular.module("app",["ngMaterial","ngAnimate","ngMessages","ui.router","ngFileUpload","wj"]).config(e).run(t),e.$inject=["$locationProvider","$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$mdThemingProvider"],t.$inject=["$rootScope","$http"]}();
!function(){"use strict";function c(c){return c("cache")}angular.module("app").factory("Cache",c),c.$inject=["$cacheFactory"]}();
!function(){"use strict";function t(t,e,n,r,c){function i(u){return function(){var a=n.defer();return r.get(u)?a.resolve(r.get(u)):e.get(t.apiUrl+"/"+u).then(function(t){r.put(u,t.data),a.resolve(t.data)})["catch"](function(t){a.reject(t.data)}),c.On(u,function(e){i(u)().then(function(n){switch(e.action){case"created":n.push(e.item),r.put(u,n);break;case"updated":var c=_.findIndex(n,{_id:e.item._id});n[c]=e.item,r.put(u,n);break;case"deleted":n=_.without(n,_.findWhere(n,{_id:e._id})),r.put(u,n)}t.$broadcast(u,e)})}),a.promise}}function u(t){return function(e){return i(t)().then(function(t){return _.findWhere(t,{_id:e})})}}function a(r){return function(c){var i=n.defer();return e.post(t.apiUrl+"/"+r,c).then(function(t){i.resolve()})["catch"](function(t){i.reject(t.data)}),i.promise}}function o(r){return function(c){var i=n.defer();return e.put(t.apiUrl+"/"+r+"/"+c._id,c).then(function(t){i.resolve()})["catch"](function(t){i.reject(t.data)}),i.promise}}function f(r){return function(c){var i=n.defer();return e["delete"](t.apiUrl+"/"+r+"/"+c).then(function(t){i.resolve()})["catch"](function(t){i.reject(t.data)}),i.promise}}var d={};return d.GetAll=i,d.GetById=u,d.Create=a,d.Update=o,d.Delete=f,d}angular.module("app").factory("DataService",t),t.$inject=["$rootScope","$http","$q","Cache","Socket"]}();
!function(){"use strict";function e(e,t,o){function a(o){t["delete"](e.apiUrl+o.path)}var l={};return l.Upload=o.upload,l.Delete=a,l}angular.module("app").factory("FileService",e),e.$inject=["$rootScope","$http","Upload"]}();
!function(){"use strict";function n(n){function t(t,o){_.contains(n.socketListeners,t)||(n.socketListeners.push(t),c.on(t,function(){var t=arguments;n.$apply(function(){o.apply(c,t)})}))}function o(t,o,e){c.emit(t,o,function(){var t=arguments;n.$apply(function(){e&&e.apply(c,t)})})}var c=io.connect(n.apiUrl),e={};return e.On=t,e.Emit=o,n.socketListeners=[],e}angular.module("app").factory("Socket",n),n.$inject=["$rootScope"]}();
!function(){"use strict";function e(e){function t(t){return function(r){function o(){var t=this;t.message=r,t.close=e.hide}e.show({controller:o,controllerAs:"vm",templateUrl:"toast-"+t+"-template.html",hideDelay:6e3})}}var r={};return r.Success=t("success"),r.Error=t("error"),r}angular.module("app").factory("ToastService",e),e.$inject=["$mdToast"]}();
!function(){"use strict";function e(e){var t="users",r={};return r.GetAll=e.GetAll(t),r.GetById=e.GetById(t),r.Create=e.Create(t),r.Update=e.Update(t),r.Delete=e.Delete(t),r}angular.module("app").factory("UserService",e),e.$inject=["DataService"]}();
!function(){"use strict";function e(e){var t=this;t.selectedTab=0,t.tabs=[{name:"Overview",path:"/"},{name:"Users",path:"/users"}],e.$on("$stateChangeSuccess",function(e,a,s,n,c){t.selectedTab=a.data.selectedTab})}angular.module("app").controller("TabsController",e),e.$inject=["$rootScope"]}();
!function(){"use strict";function n(){}angular.module("app").controller("Overview.MainController",n)}();
!function(){"use strict";function e(e,s,r,i,t,n,o){function u(){r._id&&(d.title="Edit User",t.GetById(r._id).then(function(e){$.extend(!0,d.user,e)}),e.$on("users",function(e,s){var r=s.item&&s.item._id||s._id;r===d.user._id&&r!==d.updatedId&&n.Error("This user was just "+s.action+" by another user")})),e.$watch("files",function(){a(e.files)}),e.$on("$destroy",function(){if(!d.saved&&d.user.files){var e=_.filter(d.user.files,function(e){return!e.saved});_.each(e,function(e){o.Delete(e)})}})}function l(r){function i(){t.Create(r).then(function(){d.saved=!0,s.go("users"),n.Success("User created")})["catch"](function(e){n.Error(e)})}function u(){d.updatedId=r._id,t.Update(r).then(function(){d.saved=!0,d.filesToDelete&&_.each(d.filesToDelete,function(e){o.Delete(e)}),s.go("users"),n.Success("User updated")})["catch"](function(e){n.Error(e)})}e.userForm.$invalid||(r._id?u():i())}function a(s){if(s&&s.length){d.user.files=d.user.files||[],d.failedUploads=d.failedUploads||[];for(var r=0;r<s.length;r++){var i=s[r];i.progress=0;var t=_.findWhere(d.user.files,{name:i.name});t&&f(t),d.user.files.push(_.clone(i)),o.Upload({url:e.apiUrl+"/uploads",file:i}).progress(function(e){var s=_.findWhere(d.user.files,{name:e.config.file.name});delete s.path,s.progress=parseInt(100*e.loaded/e.total)}).success(function(e,s,r,i){var t=_.findWhere(d.user.files,{name:i.file.name});delete t.progress,t.path="/uploads/"+e}).error(function(e,s,r,i){var t=_.findWhere(d.user.files,{name:i.file.name});d.user.files=_.without(d.user.files,_.findWhere(d.user.files,t)),t.error=s+" "+e,d.failedUploads.push(t)})}}}function f(e){d.user.files=_.without(d.user.files,_.findWhere(d.user.files,{name:e.name})),e.saved?(d.filesToDelete=d.filesToDelete||[],d.filesToDelete.push(e)):o.Delete(e)}var d=this;d.title="Add User",d.user={},d.saveUser=l,d.removeFile=f,u()}angular.module("app").controller("Users.AddEditController",e),e.$inject=["$scope","$state","$stateParams","$timeout","UserService","ToastService","FileService"]}();
!function(){"use strict";function e(e,n,t,i){function o(){var n=e.$watch("vm.flexgrid",function(){l.flexgrid&&(r(),e.$on("users",function(){r()}),n())})}function r(){n.GetAll().then(function(e){l.users=e,l.flexgrid.collectionView.refresh()})}function c(e){n.Delete(e).then(function(){r()})}var l=this;l.users=[],l.deleteUser=c,o()}angular.module("app").controller("Users.MainController",e),e.$inject=["$scope","UserService","$timeout","$mdDialog"]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC1zZXJ2aWNlcy9jYWNoZS5qcyIsImFwcC1zZXJ2aWNlcy9kYXRhLnNlcnZpY2UuanMiLCJhcHAtc2VydmljZXMvZmlsZS5zZXJ2aWNlLmpzIiwiYXBwLXNlcnZpY2VzL3NvY2tldC5qcyIsImFwcC1zZXJ2aWNlcy90b2FzdC5zZXJ2aWNlLmpzIiwiYXBwLXNlcnZpY2VzL3VzZXIuc2VydmljZS5qcyIsImxheW91dC90YWJzLmNvbnRyb2xsZXIuanMiLCJvdmVydmlldy9tYWluLmNvbnRyb2xsZXIuanMiLCJ1c2Vycy9hZGQtZWRpdC5jb250cm9sbGVyLmpzIiwidXNlcnMvbWFpbi5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInN0cmljdE1vZGUiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsImRhdGEiLCJzZWxlY3RlZFRhYiIsInJ1biIsIiRyb290U2NvcGUiLCIkaHR0cCIsImFwaVVybCIsImdldCIsInRoZW4iLCJyZXMiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCJhbmd1bGFyIiwibW9kdWxlIiwiJGluamVjdCIsIlNlcnZpY2UiLCIkY2FjaGVGYWN0b3J5IiwiZmFjdG9yeSIsIiRxIiwiQ2FjaGUiLCJTb2NrZXQiLCJHZXRBbGwiLCJ0eXBlIiwiZGVmZXJyZWQiLCJkZWZlciIsInJlc29sdmUiLCJwdXQiLCJyZWplY3QiLCJPbiIsIml0ZW1zIiwiYWN0aW9uIiwicHVzaCIsIml0ZW0iLCJpbmRleCIsIl8iLCJmaW5kSW5kZXgiLCJfaWQiLCJ3aXRob3V0IiwiZmluZFdoZXJlIiwiJGJyb2FkY2FzdCIsInByb21pc2UiLCJHZXRCeUlkIiwiQ3JlYXRlIiwicG9zdCIsIlVwZGF0ZSIsIkRlbGV0ZSIsInNlcnZpY2UiLCJVcGxvYWQiLCJkZWxldGVGaWxlIiwiZmlsZSIsInBhdGgiLCJ1cGxvYWQiLCJldmVudE5hbWUiLCJjYWxsYmFjayIsImNvbnRhaW5zIiwic29ja2V0TGlzdGVuZXJzIiwic29ja2V0Iiwib24iLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiLCJFbWl0IiwiZW1pdCIsImlvIiwiY29ubmVjdCIsIiRtZFRvYXN0IiwiRmxhc2giLCJtZXNzYWdlIiwiQ29udHJvbGxlciIsInZtIiwidGhpcyIsImNsb3NlIiwiaGlkZSIsInNob3ciLCJoaWRlRGVsYXkiLCJTdWNjZXNzIiwiRXJyb3IiLCJEYXRhU2VydmljZSIsInRhYnMiLCJuYW1lIiwiJG9uIiwiZXZlbnQiLCJ0b1N0YXRlIiwidG9QYXJhbXMiLCJmcm9tU3RhdGUiLCJmcm9tUGFyYW1zIiwiJHNjb3BlIiwiJHN0YXRlIiwiJHN0YXRlUGFyYW1zIiwiJHRpbWVvdXQiLCJVc2VyU2VydmljZSIsIlRvYXN0U2VydmljZSIsIkZpbGVTZXJ2aWNlIiwiaW5pdENvbnRyb2xsZXIiLCJ0aXRsZSIsInVzZXIiLCIkIiwiZXh0ZW5kIiwidXBkYXRlZElkIiwiJHdhdGNoIiwidXBsb2FkRmlsZXMiLCJmaWxlcyIsInNhdmVkIiwidW5zYXZlZEZpbGVzIiwiZmlsdGVyIiwiZWFjaCIsInNhdmVVc2VyIiwiY3JlYXRlVXNlciIsImdvIiwiZXJyb3IiLCJ1cGRhdGVVc2VyIiwiZmlsZXNUb0RlbGV0ZSIsInVzZXJGb3JtIiwiJGludmFsaWQiLCJsZW5ndGgiLCJmYWlsZWRVcGxvYWRzIiwiaSIsInByb2dyZXNzIiwiZXhpc3RpbmdGaWxlIiwicmVtb3ZlRmlsZSIsImNsb25lIiwiZXZ0IiwicGFyc2VJbnQiLCJsb2FkZWQiLCJ0b3RhbCIsInN1Y2Nlc3MiLCJzdGF0dXMiLCIkbWREaWFsb2ciLCJ3YXRjaCIsImZsZXhncmlkIiwibG9hZFVzZXJzIiwidXNlcnMiLCJjb2xsZWN0aW9uVmlldyIsInJlZnJlc2giLCJkZWxldGVVc2VyIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNJLFlBT0EsU0FBU0EsR0FBT0MsRUFBbUJDLEVBQWdCQyxFQUFvQkMsRUFBNEJDLEdBQy9GSixFQUFrQkssV0FBVSxHQUc1QkgsRUFBbUJJLFVBQVUsS0FHN0JILEVBQTJCSSxZQUFXLEdBRXRDTixFQUNLTyxNQUFNLFlBQ0hDLElBQUssSUFDTEMsWUFBYSxxQkFDYkMsV0FBWSwwQkFDWkMsYUFBYyxLQUNkQyxNQUFRQyxZQUFhLEtBRXhCTixNQUFNLFNBQ0hDLElBQUssU0FDTEMsWUFBYSxrQkFDYkMsV0FBWSx1QkFDWkMsYUFBYyxLQUNkQyxNQUFRQyxZQUFhLEtBRXBCTixNQUFNLGFBQ0hDLElBQUssT0FDTEMsWUFBYSxzQkFDYkMsV0FBWSwwQkFDWkMsYUFBYyxPQUVqQkosTUFBTSxjQUNIQyxJQUFLLGFBQ0xDLFlBQWEsc0JBQ2JDLFdBQVksMEJBQ1pDLGFBQWMsT0FLOUIsUUFBU0csR0FBSUMsRUFBWUMsR0FDckJELEVBQVdFLE9BQVMsd0JBRXBCRCxFQUFNRSxJQUFJLFVBQVVDLEtBQUssU0FBVUMsR0FDL0JKLEVBQU1LLFNBQVNDLFFBQVFDLE9BQXNCLGNBQUksVUFBWUgsRUFBSVIsT0FoRHpFWSxRQUNLQyxPQUFPLE9BQVEsYUFBYyxZQUFhLGFBQWMsWUFBYSxlQUFnQixPQUNyRjNCLE9BQU9BLEdBQ1BnQixJQUFJQSxHQXVDVGhCLEVBQU80QixTQUFXLG9CQUFxQixpQkFBa0IscUJBQXNCLDZCQUE4QixzQkFTN0daLEVBQUlZLFNBQVcsYUFBYztDQ3REakMsV0FDSSxZQU1BLFNBQVNDLEdBQVFDLEdBQ2IsTUFBT0EsR0FBYyxTQUx6QkosUUFDS0MsT0FBTyxPQUNQSSxRQUFRLFFBQVNGLEdBS3RCQSxFQUFRRCxTQUFXO0NDUHZCLFdBQ0ksWUFNQSxTQUFTQyxHQUFRWixFQUFZQyxFQUFPYyxFQUFJQyxFQUFPQyxHQVczQyxRQUFTQyxHQUFPQyxHQUNaLE1BQU8sWUFDSCxHQUFJQyxHQUFXTCxFQUFHTSxPQTZDbEIsT0EzQ0tMLEdBQU1iLElBQUlnQixHQWFYQyxFQUFTRSxRQUFRTixFQUFNYixJQUFJZ0IsSUFYM0JsQixFQUFNRSxJQUFJSCxFQUFXRSxPQUFTLElBQU1pQixHQUMvQmYsS0FBSyxTQUFVQyxHQUVaVyxFQUFNTyxJQUFJSixFQUFNZCxFQUFJUixNQUNwQnVCLEVBQVNFLFFBQVFqQixFQUFJUixRQUo3QkksU0FNVyxTQUFVSSxHQUNiZSxFQUFTSSxPQUFPbkIsRUFBSVIsUUFRaENvQixFQUFPUSxHQUFHTixFQUFNLFNBQVV0QixHQUN0QnFCLEVBQU9DLEtBQVFmLEtBQUssU0FBVXNCLEdBQzFCLE9BQVE3QixFQUFLOEIsUUFDVCxJQUFLLFVBRURELEVBQU1FLEtBQUsvQixFQUFLZ0MsTUFDaEJiLEVBQU1PLElBQUlKLEVBQU1PLEVBQ2hCLE1BQ0osS0FBSyxVQUVELEdBQUlJLEdBQVFDLEVBQUVDLFVBQVVOLEdBQVNPLElBQUtwQyxFQUFLZ0MsS0FBS0ksS0FDaERQLEdBQU1JLEdBQVNqQyxFQUFLZ0MsS0FDcEJiLEVBQU1PLElBQUlKLEVBQU1PLEVBQ2hCLE1BQ0osS0FBSyxVQUVEQSxFQUFRSyxFQUFFRyxRQUFRUixFQUFPSyxFQUFFSSxVQUFVVCxHQUFTTyxJQUFLcEMsRUFBS29DLE9BQ3hEakIsRUFBTU8sSUFBSUosRUFBTU8sR0FLeEIxQixFQUFXb0MsV0FBV2pCLEVBQU10QixPQUk3QnVCLEVBQVNpQixTQUl4QixRQUFTQyxHQUFRbkIsR0FDYixNQUFPLFVBQVVjLEdBQ2IsTUFBT2YsR0FBT0MsS0FBUWYsS0FBSyxTQUFVc0IsR0FDakMsTUFBT0ssR0FBRUksVUFBVVQsR0FBU08sSUFBS0EsT0FLN0MsUUFBU00sR0FBT3BCLEdBQ1osTUFBTyxVQUFVVSxHQUNiLEdBQUlULEdBQVdMLEVBQUdNLE9BTWxCLE9BSkFwQixHQUFNdUMsS0FBS3hDLEVBQVdFLE9BQVMsSUFBTWlCLEVBQU1VLEdBQ3RDekIsS0FBSyxTQUFVQyxHQUFPZSxFQUFTRSxZQURwQ3JCLFNBRVcsU0FBVUksR0FBT2UsRUFBU0ksT0FBT25CLEVBQUlSLFFBRXpDdUIsRUFBU2lCLFNBSXhCLFFBQVNJLEdBQU90QixHQUNaLE1BQU8sVUFBVVUsR0FDYixHQUFJVCxHQUFXTCxFQUFHTSxPQU1sQixPQUpBcEIsR0FBTXNCLElBQUl2QixFQUFXRSxPQUFTLElBQU1pQixFQUFPLElBQU1VLEVBQUtJLElBQUtKLEdBQ3REekIsS0FBSyxTQUFVQyxHQUFPZSxFQUFTRSxZQURwQ3JCLFNBRVcsU0FBVUksR0FBT2UsRUFBU0ksT0FBT25CLEVBQUlSLFFBRXpDdUIsRUFBU2lCLFNBSXhCLFFBQVNLLEdBQU92QixHQUNaLE1BQU8sVUFBVWMsR0FDYixHQUFJYixHQUFXTCxFQUFHTSxPQU1sQixPQUpBcEIsR0FBQUEsVUFBYUQsRUFBV0UsT0FBUyxJQUFNaUIsRUFBTyxJQUFNYyxHQUMvQzdCLEtBQUssU0FBVUMsR0FBT2UsRUFBU0UsWUFEcENyQixTQUVXLFNBQVVJLEdBQU9lLEVBQVNJLE9BQU9uQixFQUFJUixRQUV6Q3VCLEVBQVNpQixTQXJHeEIsR0FBSU0sS0FRSixPQU5BQSxHQUFRekIsT0FBU0EsRUFDakJ5QixFQUFRTCxRQUFVQSxFQUNsQkssRUFBUUosT0FBU0EsRUFDakJJLEVBQVFGLE9BQVNBLEVBQ2pCRSxFQUFRRCxPQUFTQSxFQUVWQyxFQWJYbEMsUUFDS0MsT0FBTyxPQUNQSSxRQUFRLGNBQWVGLEdBNEc1QkEsRUFBUUQsU0FBVyxhQUFjLFFBQVMsS0FBTSxRQUFTO0NDcEg3RCxXQUNJLFlBTUEsU0FBU0MsR0FBUVosRUFBWUMsRUFBTzJDLEdBUWhDLFFBQVNDLEdBQVdDLEdBQ2hCN0MsRUFBQUEsVUFBYUQsRUFBV0UsT0FBUzRDLEVBQUtDLE1BUjFDLEdBQUlKLEtBS0osT0FIQUEsR0FBUUMsT0FBU0EsRUFBT0ksT0FDeEJMLEVBQVFELE9BQVNHLEVBRVZGLEVBVlhsQyxRQUNLQyxPQUFPLE9BQ1BJLFFBQVEsY0FBZUYsR0FjNUJBLEVBQVFELFNBQVcsYUFBYyxRQUFTO0NDbkI5QyxXQUNJLFlBTUEsU0FBU0MsR0FBUVosR0FXYixRQUFTeUIsR0FBR3dCLEVBQVdDLEdBQ2RuQixFQUFFb0IsU0FBU25ELEVBQVdvRCxnQkFBaUJILEtBQ3hDakQsRUFBV29ELGdCQUFnQnhCLEtBQUtxQixHQUNoQ0ksRUFBT0MsR0FBR0wsRUFBVyxXQUNqQixHQUFJTSxHQUFPQyxTQUNYeEQsR0FBV3lELE9BQU8sV0FDZFAsRUFBU1EsTUFBTUwsRUFBUUUsUUFNdkMsUUFBU0ksR0FBS1YsRUFBV3BELEVBQU1xRCxHQUMzQkcsRUFBT08sS0FBS1gsRUFBV3BELEVBQU0sV0FDekIsR0FBSTBELEdBQU9DLFNBQ1h4RCxHQUFXeUQsT0FBTyxXQUNWUCxHQUNBQSxFQUFTUSxNQUFNTCxFQUFRRSxPQTNCdkMsR0FBSUYsR0FBU1EsR0FBR0MsUUFBUTlELEVBQVdFLFFBQy9CeUMsSUFPSixPQUxBQSxHQUFRbEIsR0FBS0EsRUFDYmtCLEVBQVFnQixLQUFPQSxFQUVmM0QsRUFBV29ELG1CQUVKVCxFQWJYbEMsUUFDS0MsT0FBTyxPQUNQSSxRQUFRLFNBQVVGLEdBb0N2QkEsRUFBUUQsU0FBVztDQ3pDdkIsV0FDSSxZQU1BLFNBQVNDLEdBQVFtRCxHQVFiLFFBQVNDLEdBQU03QyxHQUNYLE1BQU8sVUFBVThDLEdBUWIsUUFBU0MsS0FDTCxHQUFJQyxHQUFLQyxJQUVURCxHQUFHRixRQUFVQSxFQUNiRSxFQUFHRSxNQUFRTixFQUFTTyxLQVh4QlAsRUFBU1EsTUFDTDVFLFdBQVl1RSxFQUNadEUsYUFBYyxLQUNkRixZQUFhLFNBQVd5QixFQUFPLGlCQUMvQnFELFVBQVcsT0FidkIsR0FBSTdCLEtBS0osT0FIQUEsR0FBUThCLFFBQVVULEVBQU0sV0FDeEJyQixFQUFRK0IsTUFBUVYsRUFBTSxTQUVmckIsRUFWWGxDLFFBQ0tDLE9BQU8sT0FDUEksUUFBUSxlQUFnQkYsR0E0QjdCQSxFQUFRRCxTQUFXO0NDakN2QixXQUNJLFlBTUEsU0FBU0MsR0FBUStELEdBQ2IsR0FBSXhELEdBQU8sUUFDUHdCLElBUUosT0FOQUEsR0FBUXpCLE9BQVN5RCxFQUFZekQsT0FBT0MsR0FDcEN3QixFQUFRTCxRQUFVcUMsRUFBWXJDLFFBQVFuQixHQUN0Q3dCLEVBQVFKLE9BQVNvQyxFQUFZcEMsT0FBT3BCLEdBQ3BDd0IsRUFBUUYsT0FBU2tDLEVBQVlsQyxPQUFPdEIsR0FDcEN3QixFQUFRRCxPQUFTaUMsRUFBWWpDLE9BQU92QixHQUU3QndCLEVBZFhsQyxRQUNLQyxPQUFPLE9BQ1BJLFFBQVEsY0FBZUYsR0FjNUJBLEVBQVFELFNBQVc7Q0NuQnZCLFdBQ0ksWUFNQSxTQUFTdUQsR0FBV2xFLEdBQ2hCLEdBQUltRSxHQUFLQyxJQUVURCxHQUFHckUsWUFBYyxFQUNqQnFFLEVBQUdTLE9BQ0dDLEtBQU0sV0FBWTlCLEtBQU0sTUFDeEI4QixLQUFNLFFBQVM5QixLQUFNLFdBRzNCL0MsRUFBVzhFLElBQUksc0JBQXVCLFNBQVVDLEVBQU9DLEVBQVNDLEVBQVVDLEVBQVdDLEdBQ2pGaEIsRUFBR3JFLFlBQWNrRixFQUFRbkYsS0FBS0MsY0FkdENXLFFBQ0tDLE9BQU8sT0FDUGYsV0FBVyxpQkFBa0J1RSxHQWVsQ0EsRUFBV3ZELFNBQVc7Q0NwQjFCLFdBQ0ksWUFNQSxTQUFTdUQsTUFKVHpELFFBQ0tDLE9BQU8sT0FDUGYsV0FBVywwQkFBMkJ1RTtDQ0wvQyxXQUNJLFlBTUEsU0FBU0EsR0FBV2tCLEVBQVFDLEVBQVFDLEVBQWNDLEVBQVVDLEVBQWFDLEVBQWNDLEdBVW5GLFFBQVNDLEtBQ0RMLEVBQWFyRCxNQUNia0MsRUFBR3lCLE1BQVEsWUFDWEosRUFBWWxELFFBQVFnRCxFQUFhckQsS0FDNUI3QixLQUFLLFNBQVV5RixHQUVaQyxFQUFFQyxRQUFPLEVBQU01QixFQUFHMEIsS0FBTUEsS0FJaENULEVBQU9OLElBQUksUUFBUyxTQUFVQyxFQUFPbEYsR0FDakMsR0FBSW9DLEdBQU1wQyxFQUFLZ0MsTUFBUWhDLEVBQUtnQyxLQUFLSSxLQUFPcEMsRUFBS29DLEdBQ3pDQSxLQUFRa0MsRUFBRzBCLEtBQUs1RCxLQUFPQSxJQUFRa0MsRUFBRzZCLFdBQ2xDUCxFQUFhZixNQUFNLHNCQUF3QjdFLEVBQUs4QixPQUFTLHVCQUtyRXlELEVBQU9hLE9BQU8sUUFBUyxXQUNuQkMsRUFBWWQsRUFBT2UsU0FHdkJmLEVBQU9OLElBQUksV0FBWSxXQUVuQixJQUFLWCxFQUFHaUMsT0FBU2pDLEVBQUcwQixLQUFLTSxNQUFPLENBQzVCLEdBQUlFLEdBQWV0RSxFQUFFdUUsT0FBT25DLEVBQUcwQixLQUFLTSxNQUFPLFNBQVVyRCxHQUFRLE9BQVFBLEVBQUtzRCxPQUMxRXJFLEdBQUV3RSxLQUFLRixFQUFjLFNBQVV2RCxHQUMzQjRDLEVBQVloRCxPQUFPSSxRQU1uQyxRQUFTMEQsR0FBU1gsR0FXZCxRQUFTWSxLQUNMakIsRUFBWWpELE9BQU9zRCxHQUNkekYsS0FBSyxXQUNGK0QsRUFBR2lDLE9BQVEsRUFDWGYsRUFBT3FCLEdBQUcsU0FDVmpCLEVBQWFoQixRQUFRLGtCQUo3QmUsU0FNVyxTQUFVbUIsR0FDYmxCLEVBQWFmLE1BQU1pQyxLQUkvQixRQUFTQyxLQUNMekMsRUFBRzZCLFVBQVlILEVBQUs1RCxJQUNwQnVELEVBQVkvQyxPQUFPb0QsR0FDZHpGLEtBQUssV0FDRitELEVBQUdpQyxPQUFRLEVBR1BqQyxFQUFHMEMsZUFDSDlFLEVBQUV3RSxLQUFLcEMsRUFBRzBDLGNBQWUsU0FBVS9ELEdBQy9CNEMsRUFBWWhELE9BQU9JLEtBSzNCdUMsRUFBT3FCLEdBQUcsU0FDVmpCLEVBQWFoQixRQUFRLGtCQWI3QmUsU0FlVyxTQUFVbUIsR0FDYmxCLEVBQWFmLE1BQU1pQyxLQXhDM0J2QixFQUFPMEIsU0FBU0MsV0FJZmxCLEVBQUs1RCxJQUdOMkUsSUFGQUgsS0F3Q1IsUUFBU1AsR0FBWUMsR0FDakIsR0FBSUEsR0FBU0EsRUFBTWEsT0FBUSxDQUN2QjdDLEVBQUcwQixLQUFLTSxNQUFRaEMsRUFBRzBCLEtBQUtNLFVBQ3hCaEMsRUFBRzhDLGNBQWdCOUMsRUFBRzhDLGlCQUN0QixLQUFLLEdBQUlDLEdBQUksRUFBR0EsRUFBSWYsRUFBTWEsT0FBUUUsSUFBSyxDQUNuQyxHQUFJcEUsR0FBT3FELEVBQU1lLEVBQ2pCcEUsR0FBS3FFLFNBQVcsQ0FHaEIsSUFBSUMsR0FBZXJGLEVBQUVJLFVBQVVnQyxFQUFHMEIsS0FBS00sT0FBU3RCLEtBQU0vQixFQUFLK0IsTUFDdkR1QyxJQUFjQyxFQUFXRCxHQUc3QmpELEVBQUcwQixLQUFLTSxNQUFNdkUsS0FBS0csRUFBRXVGLE1BQU14RSxJQUczQjRDLEVBQVk5QyxRQUNKbkQsSUFBSzJGLEVBQU9sRixPQUFTLFdBQ3JCNEMsS0FBTUEsSUFFVHFFLFNBQVMsU0FBVUksR0FDaEIsR0FBSXpFLEdBQU9mLEVBQUVJLFVBQVVnQyxFQUFHMEIsS0FBS00sT0FBU3RCLEtBQU0wQyxFQUFJeEksT0FBTytELEtBQUsrQixhQUN2RC9CLEdBQUtDLEtBQ1pELEVBQUtxRSxTQUFXSyxTQUFTLElBQVFELEVBQUlFLE9BQVNGLEVBQUlHLFNBRXJEQyxRQUFRLFNBQVU5SCxFQUFNK0gsRUFBUXJILEVBQVN4QixHQUN0QyxHQUFJK0QsR0FBT2YsRUFBRUksVUFBVWdDLEVBQUcwQixLQUFLTSxPQUFTdEIsS0FBTTlGLEVBQU8rRCxLQUFLK0IsYUFDbkQvQixHQUFLcUUsU0FDWnJFLEVBQUtDLEtBQU8sWUFBY2xELElBRTdCOEcsTUFBTSxTQUFVOUcsRUFBTStILEVBQVFySCxFQUFTeEIsR0FDcEMsR0FBSStELEdBQU9mLEVBQUVJLFVBQVVnQyxFQUFHMEIsS0FBS00sT0FBU3RCLEtBQU05RixFQUFPK0QsS0FBSytCLE1BQzFEVixHQUFHMEIsS0FBS00sTUFBUXBFLEVBQUVHLFFBQVFpQyxFQUFHMEIsS0FBS00sTUFBT3BFLEVBQUVJLFVBQVVnQyxFQUFHMEIsS0FBS00sTUFBT3JELElBQ3BFQSxFQUFLNkQsTUFBUWlCLEVBQVMsSUFBTS9ILEVBQzVCc0UsRUFBRzhDLGNBQWNyRixLQUFLa0IsT0FNMUMsUUFBU3VFLEdBQVd2RSxHQUNoQnFCLEVBQUcwQixLQUFLTSxNQUFRcEUsRUFBRUcsUUFBUWlDLEVBQUcwQixLQUFLTSxNQUFPcEUsRUFBRUksVUFBVWdDLEVBQUcwQixLQUFLTSxPQUFTdEIsS0FBTS9CLEVBQUsrQixRQUU1RS9CLEVBQUtzRCxPQUtOakMsRUFBRzBDLGNBQWdCMUMsRUFBRzBDLGtCQUN0QjFDLEVBQUcwQyxjQUFjakYsS0FBS2tCLElBSnRCNEMsRUFBWWhELE9BQU9JLEdBckkzQixHQUFJcUIsR0FBS0MsSUFFVEQsR0FBR3lCLE1BQVEsV0FDWHpCLEVBQUcwQixRQUNIMUIsRUFBR3FDLFNBQVdBLEVBQ2RyQyxFQUFHa0QsV0FBYUEsRUFFaEIxQixJQVpKbEYsUUFDS0MsT0FBTyxPQUNQZixXQUFXLDBCQUEyQnVFLEdBZ0ozQ0EsRUFBV3ZELFNBQVcsU0FBVSxTQUFVLGVBQWdCLFdBQVksY0FBZSxlQUFnQjtDQ3JKekcsV0FDSSxZQU1BLFNBQVN1RCxHQUFXa0IsRUFBUUksRUFBYUQsRUFBVXNDLEdBUS9DLFFBQVNsQyxLQUVMLEdBQUltQyxHQUFRMUMsRUFBT2EsT0FBTyxjQUFlLFdBQ2pDOUIsRUFBRzRELFdBQ0hDLElBR0E1QyxFQUFPTixJQUFJLFFBQVMsV0FBY2tELE1BR2xDRixPQUtaLFFBQVNFLEtBQ0x4QyxFQUFZdEUsU0FDUGQsS0FBSyxTQUFVNkgsR0FDWjlELEVBQUc4RCxNQUFRQSxFQUNYOUQsRUFBRzRELFNBQVNHLGVBQWVDLFlBSXZDLFFBQVNDLEdBQVduRyxHQUNoQnVELEVBQVk5QyxPQUFPVCxHQUNkN0IsS0FBSyxXQUNGNEgsTUFqQ1osR0FBSTdELEdBQUtDLElBRVRELEdBQUc4RCxTQUNIOUQsRUFBR2lFLFdBQWFBLEVBRWhCekMsSUFWSmxGLFFBQ0tDLE9BQU8sT0FDUGYsV0FBVyx1QkFBd0J1RSxHQXdDeENBLEVBQVd2RCxTQUFXLFNBQVUsY0FBZSxXQUFZIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJywgWyduZ01hdGVyaWFsJywgJ25nQW5pbWF0ZScsICduZ01lc3NhZ2VzJywgJ3VpLnJvdXRlcicsICduZ0ZpbGVVcGxvYWQnLCAnd2onXSlcbiAgICAgICAgLmNvbmZpZyhjb25maWcpXG4gICAgICAgIC5ydW4ocnVuKTtcblxuICAgIGZ1bmN0aW9uIGNvbmZpZygkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIsICRtZFRoZW1pbmdQcm92aWRlcikge1xuICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4gICAgICAgIC8vIGRlZmF1bHQgcm91dGVcclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcclxuXHJcbiAgICAgICAgLy8gbWFrZSB0cmFpbGluZyBzbGFzaCBpbiB1cmxzIG9wdGlvbmFsXHJcbiAgICAgICAgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIuc3RyaWN0TW9kZShmYWxzZSk7XHJcblxyXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnb3ZlcnZpZXcnLCB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnb3ZlcnZpZXcvbWFpbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdPdmVydmlldy5NYWluQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7IHNlbGVjdGVkVGFiOiAwIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCd1c2VycycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy91c2VycycsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3VzZXJzL21haW4uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVXNlcnMuTWFpbkNvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogeyBzZWxlY3RlZFRhYjogMSB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3VzZXJzLmFkZCcsIHtcclxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYWRkJyxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3VzZXJzL2FkZC1lZGl0Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2Vycy5BZGRFZGl0Q29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnN0YXRlKCd1c2Vycy5lZGl0Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9lZGl0LzpfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndXNlcnMvYWRkLWVkaXQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJzLkFkZEVkaXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgfVxuICAgIGNvbmZpZy4kaW5qZWN0ID0gW1wiJGxvY2F0aW9uUHJvdmlkZXJcIiwgXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBcIiR1cmxNYXRjaGVyRmFjdG9yeVByb3ZpZGVyXCIsIFwiJG1kVGhlbWluZ1Byb3ZpZGVyXCJdO1xuXG4gICAgZnVuY3Rpb24gcnVuKCRyb290U2NvcGUsICRodHRwKSB7XG4gICAgICAgICRyb290U2NvcGUuYXBpVXJsID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMSc7XG5cbiAgICAgICAgJGh0dHAuZ2V0KCcvdG9rZW4nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSAnQmVhcmVyICcgKyByZXMuZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJ1bi4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcIiRodHRwXCJdO1xuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0NhY2hlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZSgkY2FjaGVGYWN0b3J5KSB7XHJcbiAgICAgICAgcmV0dXJuICRjYWNoZUZhY3RvcnkoJ2NhY2hlJyk7XHJcbiAgICB9XHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkY2FjaGVGYWN0b3J5XCJdO1xyXG5cclxufSkoKTtcclxuIiwiLypcclxuICAgIEdlbmVyaWMgZGF0YSBzZXJ2aWNlIGZvciBhY2Nlc3NpbmcgYXBpIGFuZCBjYWNoaW5nIHJlc3VsdHNcclxuKi9cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnRGF0YVNlcnZpY2UnLCBTZXJ2aWNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXJ2aWNlKCRyb290U2NvcGUsICRodHRwLCAkcSwgQ2FjaGUsIFNvY2tldCkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UuR2V0QWxsID0gR2V0QWxsO1xyXG4gICAgICAgIHNlcnZpY2UuR2V0QnlJZCA9IEdldEJ5SWQ7XHJcbiAgICAgICAgc2VydmljZS5DcmVhdGUgPSBDcmVhdGU7XHJcbiAgICAgICAgc2VydmljZS5VcGRhdGUgPSBVcGRhdGU7XHJcbiAgICAgICAgc2VydmljZS5EZWxldGUgPSBEZWxldGU7XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBHZXRBbGwodHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIUNhY2hlLmdldCh0eXBlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCBkYXRhIGZyb20gYXBpXHJcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAuZ2V0KCRyb290U2NvcGUuYXBpVXJsICsgJy8nICsgdHlwZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FjaGUgZGF0YSB0aGVuIHJldHVyblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FjaGUucHV0KHR5cGUsIHJlcy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlcy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiBkYXRhIGZyb20gY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKENhY2hlLmdldCh0eXBlKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc3Vic2NyaWJlIHRvIGFueSBjaGFuZ2VzIHRvIHRoaXMgdHlwZVxyXG4gICAgICAgICAgICAgICAgU29ja2V0Lk9uKHR5cGUsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgR2V0QWxsKHR5cGUpKCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChkYXRhLmFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGl0ZW0gdG8gY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGRhdGEuaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FjaGUucHV0KHR5cGUsIGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBpdGVtIGluIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gXy5maW5kSW5kZXgoaXRlbXMsIHsgX2lkOiBkYXRhLml0ZW0uX2lkIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNbaW5kZXhdID0gZGF0YS5pdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhY2hlLnB1dCh0eXBlLCBpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdkZWxldGVkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgaXRlbSBmcm9tIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBfLndpdGhvdXQoaXRlbXMsIF8uZmluZFdoZXJlKGl0ZW1zLCB7IF9pZDogZGF0YS5faWQgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhY2hlLnB1dCh0eXBlLCBpdGVtcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnJvYWRjYXN0IGV2ZW50IHRvIGNvbnRyb2xsZXJzIHRvIHVwZGF0ZSB2aWV3c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QodHlwZSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gR2V0QnlJZCh0eXBlKSB7IFxyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF9pZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEdldEFsbCh0eXBlKSgpLnRoZW4oZnVuY3Rpb24gKGl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uZmluZFdoZXJlKGl0ZW1zLCB7IF9pZDogX2lkIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIENyZWF0ZSh0eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCRyb290U2NvcGUuYXBpVXJsICsgJy8nICsgdHlwZSwgaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlc29sdmUoKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gVXBkYXRlKHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgICRodHRwLnB1dCgkcm9vdFNjb3BlLmFwaVVybCArICcvJyArIHR5cGUgKyAnLycgKyBpdGVtLl9pZCwgaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlc29sdmUoKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRGVsZXRlKHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfaWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCRyb290U2NvcGUuYXBpVXJsICsgJy8nICsgdHlwZSArICcvJyArIF9pZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlc29sdmUoKTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHJlcykgeyBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRxXCIsIFwiQ2FjaGVcIiwgXCJTb2NrZXRcIl07XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdGaWxlU2VydmljZScsIFNlcnZpY2UpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlcnZpY2UoJHJvb3RTY29wZSwgJGh0dHAsIFVwbG9hZCkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UuVXBsb2FkID0gVXBsb2FkLnVwbG9hZDtcclxuICAgICAgICBzZXJ2aWNlLkRlbGV0ZSA9IGRlbGV0ZUZpbGU7XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWxldGVGaWxlKGZpbGUpIHtcclxuICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCRyb290U2NvcGUuYXBpVXJsICsgZmlsZS5wYXRoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCJVcGxvYWRcIl07XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdTb2NrZXQnLCBTZXJ2aWNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXJ2aWNlKCRyb290U2NvcGUpIHtcclxuICAgICAgICB2YXIgc29ja2V0ID0gaW8uY29ubmVjdCgkcm9vdFNjb3BlLmFwaVVybCk7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcclxuICAgICAgICBcclxuICAgICAgICBzZXJ2aWNlLk9uID0gT247XHJcbiAgICAgICAgc2VydmljZS5FbWl0ID0gRW1pdDtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS5zb2NrZXRMaXN0ZW5lcnMgPSBbXTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIE9uKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgaWYgKCFfLmNvbnRhaW5zKCRyb290U2NvcGUuc29ja2V0TGlzdGVuZXJzLCBldmVudE5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNvY2tldExpc3RlbmVycy5wdXNoKGV2ZW50TmFtZSk7XHJcbiAgICAgICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEVtaXQoZXZlbnROYW1lLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdChldmVudE5hbWUsIGRhdGEsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCJdO1xyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnVG9hc3RTZXJ2aWNlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZSgkbWRUb2FzdCkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UuU3VjY2VzcyA9IEZsYXNoKCdzdWNjZXNzJyk7XHJcbiAgICAgICAgc2VydmljZS5FcnJvciA9IEZsYXNoKCdlcnJvcicpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRmxhc2godHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICRtZFRvYXN0LnNob3coe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndG9hc3QtJyArIHR5cGUgKyAnLXRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhpZGVEZWxheTogNjAwMCxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IG1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2xvc2UgPSAkbWRUb2FzdC5oaWRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgU2VydmljZS4kaW5qZWN0ID0gW1wiJG1kVG9hc3RcIl07XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZShEYXRhU2VydmljZSkge1xyXG4gICAgICAgIHZhciB0eXBlID0gJ3VzZXJzJztcclxuICAgICAgICB2YXIgc2VydmljZSA9IHt9O1xyXG5cclxuICAgICAgICBzZXJ2aWNlLkdldEFsbCA9IERhdGFTZXJ2aWNlLkdldEFsbCh0eXBlKTtcclxuICAgICAgICBzZXJ2aWNlLkdldEJ5SWQgPSBEYXRhU2VydmljZS5HZXRCeUlkKHR5cGUpO1xyXG4gICAgICAgIHNlcnZpY2UuQ3JlYXRlID0gRGF0YVNlcnZpY2UuQ3JlYXRlKHR5cGUpO1xyXG4gICAgICAgIHNlcnZpY2UuVXBkYXRlID0gRGF0YVNlcnZpY2UuVXBkYXRlKHR5cGUpO1xyXG4gICAgICAgIHNlcnZpY2UuRGVsZXRlID0gRGF0YVNlcnZpY2UuRGVsZXRlKHR5cGUpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgIH1cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIkRhdGFTZXJ2aWNlXCJdO1xyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignVGFic0NvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRyb290U2NvcGUpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5zZWxlY3RlZFRhYiA9IDA7XHJcbiAgICAgICAgdm0udGFicyA9IFtcclxuICAgICAgICAgICAgeyBuYW1lOiAnT3ZlcnZpZXcnLCBwYXRoOiAnLycgfSxcclxuICAgICAgICAgICAgeyBuYW1lOiAnVXNlcnMnLCBwYXRoOiAnL3VzZXJzJyB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRUYWIgPSB0b1N0YXRlLmRhdGEuc2VsZWN0ZWRUYWI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCJdO1xyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ092ZXJ2aWV3Lk1haW5Db250cm9sbGVyJywgQ29udHJvbGxlcik7XG5cbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdVc2Vycy5BZGRFZGl0Q29udHJvbGxlcicsIENvbnRyb2xsZXIpO1xuXG4gICAgZnVuY3Rpb24gQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkdGltZW91dCwgVXNlclNlcnZpY2UsIFRvYXN0U2VydmljZSwgRmlsZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnRpdGxlID0gJ0FkZCBVc2VyJztcbiAgICAgICAgdm0udXNlciA9IHt9O1xuICAgICAgICB2bS5zYXZlVXNlciA9IHNhdmVVc2VyO1xuICAgICAgICB2bS5yZW1vdmVGaWxlID0gcmVtb3ZlRmlsZTtcblxuICAgICAgICBpbml0Q29udHJvbGxlcigpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGluaXRDb250cm9sbGVyKCkge1xyXG4gICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgdm0udGl0bGUgPSAnRWRpdCBVc2VyJztcclxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkdldEJ5SWQoJHN0YXRlUGFyYW1zLl9pZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWVwIGNsb25lIHVzZXIgaW50byB2bS51c2VyIHRvIHByZXZlbnQgdW5zYXZlZCBjaGFuZ2VzIHN0YXlpbmcgaW4gdGhlIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHZtLnVzZXIsIHVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cbiAgICAgICAgICAgICAgICAvLyBhbGVydCBpZiB1c2VyIGlzIHVwZGF0ZWQvZGVsZXRlZCBieSBhbm90aGVyIHVzZXJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCd1c2VycycsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfaWQgPSBkYXRhLml0ZW0gJiYgZGF0YS5pdGVtLl9pZCB8fCBkYXRhLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX2lkID09PSB2bS51c2VyLl9pZCAmJiBfaWQgIT09IHZtLnVwZGF0ZWRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuRXJyb3IoJ1RoaXMgdXNlciB3YXMganVzdCAnICsgZGF0YS5hY3Rpb24gKyAnIGJ5IGFub3RoZXIgdXNlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZmlsZXMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRGaWxlcygkc2NvcGUuZmlsZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gZGVsZXRlIGFueSB1bnNhdmVkIC8gb3JwaGFuZWQgZmlsZXNcclxuICAgICAgICAgICAgICAgIGlmICghdm0uc2F2ZWQgJiYgdm0udXNlci5maWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1bnNhdmVkRmlsZXMgPSBfLmZpbHRlcih2bS51c2VyLmZpbGVzLCBmdW5jdGlvbiAoZmlsZSkgeyByZXR1cm4gIWZpbGUuc2F2ZWQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHVuc2F2ZWRGaWxlcywgZnVuY3Rpb24gKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRmlsZVNlcnZpY2UuRGVsZXRlKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzYXZlVXNlcih1c2VyKSB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUudXNlckZvcm0uJGludmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF1c2VyLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgY3JlYXRlVXNlcigpXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVVc2VyKCk7XHJcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNlcigpIHtcclxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkNyZWF0ZSh1c2VyKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd1c2VycycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLlN1Y2Nlc3MoJ1VzZXIgY3JlYXRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVVzZXIoKSB7XHJcbiAgICAgICAgICAgICAgICB2bS51cGRhdGVkSWQgPSB1c2VyLl9pZDtcclxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLlVwZGF0ZSh1c2VyKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBhbnkgZmlsZXMgZmxhZ2dlZCB0byBiZSBkZWxldGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5maWxlc1RvRGVsZXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2godm0uZmlsZXNUb0RlbGV0ZSwgZnVuY3Rpb24gKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlU2VydmljZS5EZWxldGUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gdXNlcnMgdmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3VzZXJzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5TdWNjZXNzKCdVc2VyIHVwZGF0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5FcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdXBsb2FkRmlsZXMoZmlsZXMpIHtcclxuICAgICAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdm0udXNlci5maWxlcyA9IHZtLnVzZXIuZmlsZXMgfHwgW107XHJcbiAgICAgICAgICAgICAgICB2bS5mYWlsZWRVcGxvYWRzID0gdm0uZmFpbGVkVXBsb2FkcyB8fCBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IGZpbGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgZmlsZSBpZiBpdCdzIGFscmVhZHkgaW4gdGhlIGxpc3QgdG8gcHJldmVudCBvcnBoYW5lZCBmaWxlcyBvbiB0aGUgc2VydmVyXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4aXN0aW5nRmlsZSA9IF8uZmluZFdoZXJlKHZtLnVzZXIuZmlsZXMsIHsgbmFtZTogZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ0ZpbGUpIHJlbW92ZUZpbGUoZXhpc3RpbmdGaWxlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGZpbGUgdG8gdGhlIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2VyLmZpbGVzLnB1c2goXy5jbG9uZShmaWxlKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVwbG9hZCBmaWxlIHRvIHNlcnZlclxyXG4gICAgICAgICAgICAgICAgICAgIEZpbGVTZXJ2aWNlLlVwbG9hZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICRzY29wZS5hcGlVcmwgKyAnL3VwbG9hZHMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogZmlsZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucHJvZ3Jlc3MoZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCB7IG5hbWU6IGV2dC5jb25maWcuZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGZpbGUucGF0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSBwYXJzZUludCgxMDAuMCAqIGV2dC5sb2FkZWQgLyBldnQudG90YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgeyBuYW1lOiBjb25maWcuZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGZpbGUucHJvZ3Jlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGggPSAnL3VwbG9hZHMvJyArIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgeyBuYW1lOiBjb25maWcuZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udXNlci5maWxlcyA9IF8ud2l0aG91dCh2bS51c2VyLmZpbGVzLCBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCBmaWxlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmVycm9yID0gc3RhdHVzICsgXCIgXCIgKyBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZmFpbGVkVXBsb2Fkcy5wdXNoKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmVGaWxlKGZpbGUpIHtcclxuICAgICAgICAgICAgdm0udXNlci5maWxlcyA9IF8ud2l0aG91dCh2bS51c2VyLmZpbGVzLCBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCB7IG5hbWU6IGZpbGUubmFtZSB9KSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWZpbGUuc2F2ZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIGZpbGUgbm90IGxpbmtlZCB0byB1c2VyIHNvIGRlbGV0ZSBub3dcclxuICAgICAgICAgICAgICAgIEZpbGVTZXJ2aWNlLkRlbGV0ZShmaWxlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGZpbGUgbGlua2VkIHRvIHVzZXIgc28gZmxhZyB0byBiZSBkZWxldGVkIG9uIHNhdmVcclxuICAgICAgICAgICAgICAgIHZtLmZpbGVzVG9EZWxldGUgPSB2bS5maWxlc1RvRGVsZXRlIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgdm0uZmlsZXNUb0RlbGV0ZS5wdXNoKGZpbGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxuICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIiR0aW1lb3V0XCIsIFwiVXNlclNlcnZpY2VcIiwgXCJUb2FzdFNlcnZpY2VcIiwgXCJGaWxlU2VydmljZVwiXTtcclxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignVXNlcnMuTWFpbkNvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcblxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlLCBVc2VyU2VydmljZSwgJHRpbWVvdXQsICRtZERpYWxvZykge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLnVzZXJzID0gW107XG4gICAgICAgIHZtLmRlbGV0ZVVzZXIgPSBkZWxldGVVc2VyO1xuXG4gICAgICAgIGluaXRDb250cm9sbGVyKCk7XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdENvbnRyb2xsZXIoKSB7XG4gICAgICAgICAgICAvLyB3YWl0IGZvciBmbGV4Z3JpZCB0byBpbml0aWFsaXNlIGJlZm9yZSBsb2FkaW5nIHVzZXJzXG4gICAgICAgICAgICB2YXIgd2F0Y2ggPSAkc2NvcGUuJHdhdGNoKCd2bS5mbGV4Z3JpZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5mbGV4Z3JpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRVc2VycygpO1xyXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVsb2FkIHVzZXJzIG9uICd1c2VycycgZXZlbnRcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRvbigndXNlcnMnLCBmdW5jdGlvbiAoKSB7IGxvYWRVc2VycygpOyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdW5iaW5kIHdhdGNoXHJcbiAgICAgICAgICAgICAgICAgICAgd2F0Y2goKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2FkVXNlcnMoKSB7XG4gICAgICAgICAgICBVc2VyU2VydmljZS5HZXRBbGwoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVzZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMgPSB1c2VycztcclxuICAgICAgICAgICAgICAgICAgICB2bS5mbGV4Z3JpZC5jb2xsZWN0aW9uVmlldy5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlVXNlcihfaWQpIHtcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkRlbGV0ZShfaWQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBsb2FkVXNlcnMoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCJVc2VyU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJG1kRGlhbG9nXCJdO1xuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==