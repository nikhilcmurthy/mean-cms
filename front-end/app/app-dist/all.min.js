!function(){"use strict";function e(e,t,r,o,l){e.html5Mode(!0),r.otherwise("/"),o.strictMode(!1),t.state("overview",{url:"/",templateUrl:"overview/main.html",controller:"Overview.MainController",controllerAs:"vm",data:{selectedTab:0}}).state("users",{url:"/users",templateUrl:"users/main.html",controller:"Users.MainController",controllerAs:"vm",data:{selectedTab:1}}).state("users.add",{url:"/add",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"}).state("users.edit",{url:"/edit/:_id",templateUrl:"users/add-edit.html",controller:"Users.AddEditController",controllerAs:"vm"})}function t(e,t){e.apiUrl="http://localhost:3001",t.get("/token").then(function(e){t.defaults.headers.common.Authorization="Bearer "+e.data})}e.$inject=["$locationProvider","$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$mdThemingProvider"],t.$inject=["$rootScope","$http"],angular.module("app",["ngMaterial","ngAnimate","ngMessages","ui.router","ngFileUpload","wj"]).config(e).run(t)}();
!function(){"use strict";function c(c){return c("cache")}c.$inject=["$cacheFactory"],angular.module("app").factory("Cache",c)}();
!function(){"use strict";function t(t,e,n,r,c){function i(u){return function(){var a=n.defer();return r.get(u)?a.resolve(r.get(u)):e.get(t.apiUrl+"/"+u).then(function(t){r.put(u,t.data),a.resolve(t.data)})["catch"](function(t){a.reject(t.data)}),c.On(u,function(e){i(u)().then(function(n){switch(e.action){case"created":n.push(e.item),r.put(u,n);break;case"updated":var c=_.findIndex(n,{_id:e.item._id});n[c]=e.item,r.put(u,n);break;case"deleted":n=_.without(n,_.findWhere(n,{_id:e._id})),r.put(u,n)}t.$broadcast(u,e)})}),a.promise}}function u(t){return function(e){return i(t)().then(function(t){return _.findWhere(t,{_id:e})})}}function a(r){return function(c){var i=n.defer();return e.post(t.apiUrl+"/"+r,c).then(function(t){i.resolve()})["catch"](function(t){i.reject(t.data)}),i.promise}}function o(r){return function(c){var i=n.defer();return e.put(t.apiUrl+"/"+r+"/"+c._id,c).then(function(t){i.resolve()})["catch"](function(t){i.reject(t.data)}),i.promise}}function f(r){return function(c){var i=n.defer();return e["delete"](t.apiUrl+"/"+r+"/"+c).then(function(t){i.resolve()})["catch"](function(t){i.reject(t.data)}),i.promise}}var d={};return d.GetAll=i,d.GetById=u,d.Create=a,d.Update=o,d.Delete=f,d}t.$inject=["$rootScope","$http","$q","Cache","Socket"],angular.module("app").factory("DataService",t)}();
!function(){"use strict";function e(e,t,o){function a(o){t["delete"](e.apiUrl+o.path)}var l={};return l.Upload=o.upload,l.Delete=a,l}e.$inject=["$rootScope","$http","Upload"],angular.module("app").factory("FileService",e)}();
!function(){"use strict";function n(n){function t(t,o){_.contains(n.socketListeners,t)||(n.socketListeners.push(t),c.on(t,function(){var t=arguments;n.$apply(function(){o.apply(c,t)})}))}function o(t,o,e){c.emit(t,o,function(){var t=arguments;n.$apply(function(){e&&e.apply(c,t)})})}var c=io.connect(n.apiUrl),e={};return e.On=t,e.Emit=o,n.socketListeners=[],e}n.$inject=["$rootScope"],angular.module("app").factory("Socket",n)}();
!function(){"use strict";function e(e){function t(t){return function(r){function o(){var t=this;t.message=r,t.close=e.hide}e.show({controller:o,controllerAs:"vm",templateUrl:"toast-"+t+"-template.html",hideDelay:6e3})}}var r={};return r.Success=t("success"),r.Error=t("error"),r}e.$inject=["$mdToast"],angular.module("app").factory("ToastService",e)}();
!function(){"use strict";function e(e){var t="users",r={};return r.GetAll=e.GetAll(t),r.GetById=e.GetById(t),r.Create=e.Create(t),r.Update=e.Update(t),r.Delete=e.Delete(t),r}e.$inject=["DataService"],angular.module("app").factory("UserService",e)}();
!function(){"use strict";function e(e){var t=this;t.selectedTab=0,t.tabs=[{name:"Overview",path:"/"},{name:"Users",path:"/users"}],e.$on("$stateChangeSuccess",function(e,a,s,n,c){t.selectedTab=a.data.selectedTab})}e.$inject=["$rootScope"],angular.module("app").controller("TabsController",e)}();
!function(){"use strict";function n(){}angular.module("app").controller("Overview.MainController",n)}();
!function(){"use strict";function e(e,s,r,i,t,n,o){function u(){r._id&&(d.title="Edit User",t.GetById(r._id).then(function(e){$.extend(!0,d.user,e)}),e.$on("users",function(e,s){var r=s.item&&s.item._id||s._id;r===d.user._id&&r!==d.updatedId&&n.Error("This user was just "+s.action+" by another user")})),e.$watch("files",function(){l(e.files)}),e.$on("$destroy",function(){if(!d.saved&&d.user.files){var e=_.filter(d.user.files,function(e){return!e.saved});_.each(e,function(e){o.Delete(e)})}})}function a(r){function i(){t.Create(r).then(function(){d.saved=!0,s.go("users"),n.Success("User created")})["catch"](function(e){n.Error(e)})}function u(){d.updatedId=r._id,t.Update(r).then(function(){d.saved=!0,d.filesToDelete&&_.each(d.filesToDelete,function(e){o.Delete(e)}),s.go("users"),n.Success("User updated")})["catch"](function(e){n.Error(e)})}e.userForm.$invalid||(r._id?u():i())}function l(s){if(s&&s.length){d.user.files=d.user.files||[],d.failedUploads=d.failedUploads||[];for(var r=0;r<s.length;r++){var i=s[r];i.progress=0;var t=_.findWhere(d.user.files,{name:i.name});t&&f(t),d.user.files.push(_.clone(i)),o.Upload({url:e.apiUrl+"/uploads",file:i}).progress(function(e){var s=_.findWhere(d.user.files,{name:e.config.file.name});s.path||(s.progress=parseInt(100*e.loaded/e.total))}).success(function(e,s,r,i){var t=_.findWhere(d.user.files,{name:i.file.name});delete t.progress,t.path="/uploads/"+e}).error(function(e,s,r,i){var t=_.findWhere(d.user.files,{name:i.file.name});d.user.files=_.without(d.user.files,_.findWhere(d.user.files,t)),t.error=s+" "+e,d.failedUploads.push(t)})}}}function f(e){d.user.files=_.without(d.user.files,_.findWhere(d.user.files,{name:e.name})),e.saved?(d.filesToDelete=d.filesToDelete||[],d.filesToDelete.push(e)):o.Delete(e)}var d=this;d.title="Add User",d.user={},d.saveUser=a,d.removeFile=f,u()}e.$inject=["$scope","$state","$stateParams","$timeout","UserService","ToastService","FileService"],angular.module("app").controller("Users.AddEditController",e)}();
!function(){"use strict";function e(e,n,t,i){function o(){var n=e.$watch("vm.flexgrid",function(){l.flexgrid&&(r(),e.$on("users",function(){r()}),n())})}function r(){n.GetAll().then(function(e){l.users=e,l.flexgrid.collectionView.refresh()})}function c(e){n.Delete(e).then(function(){r()})}var l=this;l.users=[],l.deleteUser=c,o()}e.$inject=["$scope","UserService","$timeout","$mdDialog"],angular.module("app").controller("Users.MainController",e)}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImFwcC1zZXJ2aWNlcy9jYWNoZS5qcyIsImFwcC1zZXJ2aWNlcy9kYXRhLnNlcnZpY2UuanMiLCJhcHAtc2VydmljZXMvZmlsZS5zZXJ2aWNlLmpzIiwiYXBwLXNlcnZpY2VzL3NvY2tldC5qcyIsImFwcC1zZXJ2aWNlcy90b2FzdC5zZXJ2aWNlLmpzIiwiYXBwLXNlcnZpY2VzL3VzZXIuc2VydmljZS5qcyIsImxheW91dC90YWJzLmNvbnRyb2xsZXIuanMiLCJvdmVydmlldy9tYWluLmNvbnRyb2xsZXIuanMiLCJ1c2Vycy9hZGQtZWRpdC5jb250cm9sbGVyLmpzIiwidXNlcnMvbWFpbi5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbImNvbmZpZyIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlciIsIiRtZFRoZW1pbmdQcm92aWRlciIsImh0bWw1TW9kZSIsIm90aGVyd2lzZSIsInN0cmljdE1vZGUiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsImRhdGEiLCJzZWxlY3RlZFRhYiIsInJ1biIsIiRyb290U2NvcGUiLCIkaHR0cCIsImFwaVVybCIsImdldCIsInRoZW4iLCJyZXMiLCJkZWZhdWx0cyIsImhlYWRlcnMiLCJjb21tb24iLCIkaW5qZWN0IiwiYW5ndWxhciIsIm1vZHVsZSIsIlNlcnZpY2UiLCIkY2FjaGVGYWN0b3J5IiwiZmFjdG9yeSIsIiRxIiwiQ2FjaGUiLCJTb2NrZXQiLCJHZXRBbGwiLCJ0eXBlIiwiZGVmZXJyZWQiLCJkZWZlciIsInJlc29sdmUiLCJwdXQiLCJyZWplY3QiLCJPbiIsIml0ZW1zIiwiYWN0aW9uIiwicHVzaCIsIml0ZW0iLCJpbmRleCIsIl8iLCJmaW5kSW5kZXgiLCJfaWQiLCJ3aXRob3V0IiwiZmluZFdoZXJlIiwiJGJyb2FkY2FzdCIsInByb21pc2UiLCJHZXRCeUlkIiwiQ3JlYXRlIiwicG9zdCIsIlVwZGF0ZSIsIkRlbGV0ZSIsInNlcnZpY2UiLCJVcGxvYWQiLCJkZWxldGVGaWxlIiwiZmlsZSIsInBhdGgiLCJ1cGxvYWQiLCJldmVudE5hbWUiLCJjYWxsYmFjayIsImNvbnRhaW5zIiwic29ja2V0TGlzdGVuZXJzIiwic29ja2V0Iiwib24iLCJhcmdzIiwiYXJndW1lbnRzIiwiJGFwcGx5IiwiYXBwbHkiLCJFbWl0IiwiZW1pdCIsImlvIiwiY29ubmVjdCIsIiRtZFRvYXN0IiwiRmxhc2giLCJtZXNzYWdlIiwiQ29udHJvbGxlciIsInZtIiwidGhpcyIsImNsb3NlIiwiaGlkZSIsInNob3ciLCJoaWRlRGVsYXkiLCJTdWNjZXNzIiwiRXJyb3IiLCJEYXRhU2VydmljZSIsInRhYnMiLCJuYW1lIiwiJG9uIiwiZXZlbnQiLCJ0b1N0YXRlIiwidG9QYXJhbXMiLCJmcm9tU3RhdGUiLCJmcm9tUGFyYW1zIiwiJHNjb3BlIiwiJHN0YXRlIiwiJHN0YXRlUGFyYW1zIiwiJHRpbWVvdXQiLCJVc2VyU2VydmljZSIsIlRvYXN0U2VydmljZSIsIkZpbGVTZXJ2aWNlIiwiaW5pdENvbnRyb2xsZXIiLCJ0aXRsZSIsInVzZXIiLCIkIiwiZXh0ZW5kIiwidXBkYXRlZElkIiwiJHdhdGNoIiwidXBsb2FkRmlsZXMiLCJmaWxlcyIsInNhdmVkIiwidW5zYXZlZEZpbGVzIiwiZmlsdGVyIiwiZWFjaCIsInNhdmVVc2VyIiwiY3JlYXRlVXNlciIsImdvIiwiZXJyb3IiLCJ1cGRhdGVVc2VyIiwiZmlsZXNUb0RlbGV0ZSIsInVzZXJGb3JtIiwiJGludmFsaWQiLCJsZW5ndGgiLCJmYWlsZWRVcGxvYWRzIiwiaSIsInByb2dyZXNzIiwiZXhpc3RpbmdGaWxlIiwicmVtb3ZlRmlsZSIsImNsb25lIiwiZXZ0IiwicGFyc2VJbnQiLCJsb2FkZWQiLCJ0b3RhbCIsInN1Y2Nlc3MiLCJzdGF0dXMiLCIkbWREaWFsb2ciLCJ3YXRjaCIsImZsZXhncmlkIiwibG9hZFVz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TSxNQUFPcEUsRUFBRUksVUFBVWdDLEVBQUcwQixLQUFLTSxPQUFTdEIsS0FBTS9CLEVBQUsrQixRQUU1RS9CLEVBQUtzRCxPQUtOakMsRUFBRzBDLGNBQWdCMUMsRUFBRzBDLGtCQUN0QjFDLEVBQUcwQyxjQUFjakYsS0FBS2tCLElBSnRCNEMsRUFBWWhELE9BQU9JLEdBdEkzQixHQUFJcUIsR0FBS0MsSUFFVEQsR0FBR3lCLE1BQVEsV0FDWHpCLEVBQUcwQixRQUNIMUIsRUFBR3FDLFNBQVdBLEVBQ2RyQyxFQUFHa0QsV0FBYUEsRUFFaEIxQixJQWJKekIsRUFBV3pELFNBQVcsU0FBVSxTQUFVLGVBQWdCLFdBQVksY0FBZSxlQUFnQixlQUNyR0MsUUFDS0MsT0FBTyxPQUNQaEIsV0FBVywwQkFBMkJ1RTtDQ04vQyxXQUNJLFlBT0EsU0FBU0EsR0FBV2tCLEVBQVFJLEVBQWFELEVBQVVzQyxHQVEvQyxRQUFTbEMsS0FFTCxHQUFJbUMsR0FBUTFDLEVBQU9hLE9BQU8sY0FBZSxXQUNqQzlCLEVBQUc0RCxXQUNIQyxJQUdBNUMsRUFBT04sSUFBSSxRQUFTLFdBQWNrRCxNQUdsQ0YsT0FLWixRQUFTRSxLQUNMeEMsRUFBWXRFLFNBQ1BkLEtBQUssU0FBVTZILEdBQ1o5RCxFQUFHOEQsTUFBUUEsRUFDWDlELEVBQUc0RCxTQUFTRyxlQUFlQyxZQUl2QyxRQUFTQyxHQUFXbkcsR0FDaEJ1RCxFQUFZOUMsT0FBT1QsR0FDZDdCLEtBQUssV0FDRjRILE1BakNaLEdBQUk3RCxHQUFLQyxJQUVURCxHQUFHOEQsU0FDSDlELEVBQUdpRSxXQUFhQSxFQUVoQnpDLElBWEp6QixFQUFXekQsU0FBVyxTQUFVLGNBQWUsV0FBWSxhQUMzREMsUUFDS0MsT0FBTyxPQUNQaEIsV0FBVyx1QkFBd0J1RSIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBjb25maWcuJGluamVjdCA9IFtcIiRsb2NhdGlvblByb3ZpZGVyXCIsIFwiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgXCIkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlclwiLCBcIiRtZFRoZW1pbmdQcm92aWRlclwiXTtcclxuICAgIHJ1bi4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcIiRodHRwXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcsIFsnbmdNYXRlcmlhbCcsICduZ0FuaW1hdGUnLCAnbmdNZXNzYWdlcycsICd1aS5yb3V0ZXInLCAnbmdGaWxlVXBsb2FkJywgJ3dqJ10pXHJcbiAgICAgICAgLmNvbmZpZyhjb25maWcpXHJcbiAgICAgICAgLnJ1bihydW4pO1xyXG5cclxuICAgIGZ1bmN0aW9uIGNvbmZpZygkbG9jYXRpb25Qcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJHVybE1hdGNoZXJGYWN0b3J5UHJvdmlkZXIsICRtZFRoZW1pbmdQcm92aWRlcikge1xyXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgLy8gZGVmYXVsdCByb3V0ZVxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvXCIpO1xyXG5cclxuICAgICAgICAvLyBtYWtlIHRyYWlsaW5nIHNsYXNoIGluIHVybHMgb3B0aW9uYWxcclxuICAgICAgICAkdXJsTWF0Y2hlckZhY3RvcnlQcm92aWRlci5zdHJpY3RNb2RlKGZhbHNlKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdvdmVydmlldycsIHtcclxuICAgICAgICAgICAgICAgIHVybDogJy8nLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdvdmVydmlldy9tYWluLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ092ZXJ2aWV3Lk1haW5Db250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHsgc2VsZWN0ZWRUYWI6IDAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ3VzZXJzJywge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnL3VzZXJzJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndXNlcnMvbWFpbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdVc2Vycy5NYWluQ29udHJvbGxlcicsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7IHNlbGVjdGVkVGFiOiAxIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5zdGF0ZSgndXNlcnMuYWRkJywge1xyXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hZGQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndXNlcnMvYWRkLWVkaXQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJzLkFkZEVkaXRDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ3VzZXJzLmVkaXQnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2VkaXQvOl9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd1c2Vycy9hZGQtZWRpdC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVXNlcnMuQWRkRWRpdENvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcnVuKCRyb290U2NvcGUsICRodHRwKSB7XHJcbiAgICAgICAgJHJvb3RTY29wZS5hcGlVcmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAxJztcclxuXHJcbiAgICAgICAgJGh0dHAuZ2V0KCcvdG9rZW4nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ0F1dGhvcml6YXRpb24nXSA9ICdCZWFyZXIgJyArIHJlcy5kYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIiRjYWNoZUZhY3RvcnlcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnQ2FjaGUnLCBTZXJ2aWNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXJ2aWNlKCRjYWNoZUZhY3RvcnkpIHtcclxuICAgICAgICByZXR1cm4gJGNhY2hlRmFjdG9yeSgnY2FjaGUnKTtcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIi8qXHJcbiAgICBHZW5lcmljIGRhdGEgc2VydmljZSBmb3IgYWNjZXNzaW5nIGFwaSBhbmQgY2FjaGluZyByZXN1bHRzXHJcbiovXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgU2VydmljZS4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHFcIiwgXCJDYWNoZVwiLCBcIlNvY2tldFwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdEYXRhU2VydmljZScsIFNlcnZpY2UpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlcnZpY2UoJHJvb3RTY29wZSwgJGh0dHAsICRxLCBDYWNoZSwgU29ja2V0KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICAgICAgc2VydmljZS5HZXRBbGwgPSBHZXRBbGw7XHJcbiAgICAgICAgc2VydmljZS5HZXRCeUlkID0gR2V0QnlJZDtcclxuICAgICAgICBzZXJ2aWNlLkNyZWF0ZSA9IENyZWF0ZTtcclxuICAgICAgICBzZXJ2aWNlLlVwZGF0ZSA9IFVwZGF0ZTtcclxuICAgICAgICBzZXJ2aWNlLkRlbGV0ZSA9IERlbGV0ZTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEdldEFsbCh0eXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghQ2FjaGUuZ2V0KHR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGRhdGEgZnJvbSBhcGlcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cC5nZXQoJHJvb3RTY29wZS5hcGlVcmwgKyAnLycgKyB0eXBlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjYWNoZSBkYXRhIHRoZW4gcmV0dXJuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWNoZS5wdXQodHlwZSwgcmVzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXMuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIGRhdGEgZnJvbSBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoQ2FjaGUuZ2V0KHR5cGUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzdWJzY3JpYmUgdG8gYW55IGNoYW5nZXMgdG8gdGhpcyB0eXBlXHJcbiAgICAgICAgICAgICAgICBTb2NrZXQuT24odHlwZSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBHZXRBbGwodHlwZSkoKS50aGVuKGZ1bmN0aW9uIChpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGRhdGEuYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGVkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgaXRlbSB0byBjYWNoZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goZGF0YS5pdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWNoZS5wdXQodHlwZSwgaXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndXBkYXRlZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIGl0ZW0gaW4gY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBfLmZpbmRJbmRleChpdGVtcywgeyBfaWQ6IGRhdGEuaXRlbS5faWQgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tpbmRleF0gPSBkYXRhLml0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FjaGUucHV0KHR5cGUsIGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RlbGV0ZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBpdGVtIGZyb20gY2FjaGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IF8ud2l0aG91dChpdGVtcywgXy5maW5kV2hlcmUoaXRlbXMsIHsgX2lkOiBkYXRhLl9pZCB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FjaGUucHV0KHR5cGUsIGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBicm9hZGNhc3QgZXZlbnQgdG8gY29udHJvbGxlcnMgdG8gdXBkYXRlIHZpZXdzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCh0eXBlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBHZXRCeUlkKHR5cGUpIHsgXHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX2lkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gR2V0QWxsKHR5cGUpKCkudGhlbihmdW5jdGlvbiAoaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5maW5kV2hlcmUoaXRlbXMsIHsgX2lkOiBfaWQgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ3JlYXRlKHR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJHJvb3RTY29wZS5hcGlVcmwgKyAnLycgKyB0eXBlLCBpdGVtKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgZGVmZXJyZWQucmVzb2x2ZSgpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlamVjdChyZXMuZGF0YSk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBVcGRhdGUodHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGh0dHAucHV0KCRyb290U2NvcGUuYXBpVXJsICsgJy8nICsgdHlwZSArICcvJyArIGl0ZW0uX2lkLCBpdGVtKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgZGVmZXJyZWQucmVzb2x2ZSgpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlamVjdChyZXMuZGF0YSk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBEZWxldGUodHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF9pZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWxldGUoJHJvb3RTY29wZS5hcGlVcmwgKyAnLycgKyB0eXBlICsgJy8nICsgX2lkKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHsgZGVmZXJyZWQucmVzb2x2ZSgpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7IGRlZmVycmVkLnJlamVjdChyZXMuZGF0YSk7IH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCJVcGxvYWRcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnRmlsZVNlcnZpY2UnLCBTZXJ2aWNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXJ2aWNlKCRyb290U2NvcGUsICRodHRwLCBVcGxvYWQpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHt9O1xyXG5cclxuICAgICAgICBzZXJ2aWNlLlVwbG9hZCA9IFVwbG9hZC51cGxvYWQ7XHJcbiAgICAgICAgc2VydmljZS5EZWxldGUgPSBkZWxldGVGaWxlO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlRmlsZShmaWxlKSB7XHJcbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSgkcm9vdFNjb3BlLmFwaVVybCArIGZpbGUucGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1NvY2tldCcsIFNlcnZpY2UpO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlcnZpY2UoJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpby5jb25uZWN0KCRyb290U2NvcGUuYXBpVXJsKTtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHt9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNlcnZpY2UuT24gPSBPbjtcclxuICAgICAgICBzZXJ2aWNlLkVtaXQgPSBFbWl0O1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLnNvY2tldExpc3RlbmVycyA9IFtdO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gT24oZXZlbnROYW1lLCBjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAoIV8uY29udGFpbnMoJHJvb3RTY29wZS5zb2NrZXRMaXN0ZW5lcnMsIGV2ZW50TmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuc29ja2V0TGlzdGVuZXJzLnB1c2goZXZlbnROYW1lKTtcclxuICAgICAgICAgICAgICAgIHNvY2tldC5vbihldmVudE5hbWUsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRW1pdChldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgU2VydmljZS4kaW5qZWN0ID0gW1wiJG1kVG9hc3RcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnVG9hc3RTZXJ2aWNlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZSgkbWRUb2FzdCkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge307XHJcblxyXG4gICAgICAgIHNlcnZpY2UuU3VjY2VzcyA9IEZsYXNoKCdzdWNjZXNzJyk7XHJcbiAgICAgICAgc2VydmljZS5FcnJvciA9IEZsYXNoKCdlcnJvcicpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gRmxhc2godHlwZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICRtZFRvYXN0LnNob3coe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IENvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndG9hc3QtJyArIHR5cGUgKyAnLXRlbXBsYXRlLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhpZGVEZWxheTogNjAwMCxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IG1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2xvc2UgPSAkbWRUb2FzdC5oaWRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIFNlcnZpY2UuJGluamVjdCA9IFtcIkRhdGFTZXJ2aWNlXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgU2VydmljZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZShEYXRhU2VydmljZSkge1xyXG4gICAgICAgIHZhciB0eXBlID0gJ3VzZXJzJztcclxuICAgICAgICB2YXIgc2VydmljZSA9IHt9O1xyXG5cclxuICAgICAgICBzZXJ2aWNlLkdldEFsbCA9IERhdGFTZXJ2aWNlLkdldEFsbCh0eXBlKTtcclxuICAgICAgICBzZXJ2aWNlLkdldEJ5SWQgPSBEYXRhU2VydmljZS5HZXRCeUlkKHR5cGUpO1xyXG4gICAgICAgIHNlcnZpY2UuQ3JlYXRlID0gRGF0YVNlcnZpY2UuQ3JlYXRlKHR5cGUpO1xyXG4gICAgICAgIHNlcnZpY2UuVXBkYXRlID0gRGF0YVNlcnZpY2UuVXBkYXRlKHR5cGUpO1xyXG4gICAgICAgIHNlcnZpY2UuRGVsZXRlID0gRGF0YVNlcnZpY2UuRGVsZXRlKHR5cGUpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiXTtcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdUYWJzQ29udHJvbGxlcicsIENvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZtLnNlbGVjdGVkVGFiID0gMDtcclxuICAgICAgICB2bS50YWJzID0gW1xyXG4gICAgICAgICAgICB7IG5hbWU6ICdPdmVydmlldycsIHBhdGg6ICcvJyB9LFxyXG4gICAgICAgICAgICB7IG5hbWU6ICdVc2VycycsIHBhdGg6ICcvdXNlcnMnIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykge1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFRhYiA9IHRvU3RhdGUuZGF0YS5zZWxlY3RlZFRhYjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignT3ZlcnZpZXcuTWFpbkNvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiJHRpbWVvdXRcIiwgXCJVc2VyU2VydmljZVwiLCBcIlRvYXN0U2VydmljZVwiLCBcIkZpbGVTZXJ2aWNlXCJdO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1VzZXJzLkFkZEVkaXRDb250cm9sbGVyJywgQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkdGltZW91dCwgVXNlclNlcnZpY2UsIFRvYXN0U2VydmljZSwgRmlsZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS50aXRsZSA9ICdBZGQgVXNlcic7XHJcbiAgICAgICAgdm0udXNlciA9IHt9O1xyXG4gICAgICAgIHZtLnNhdmVVc2VyID0gc2F2ZVVzZXI7XHJcbiAgICAgICAgdm0ucmVtb3ZlRmlsZSA9IHJlbW92ZUZpbGU7XHJcblxyXG4gICAgICAgIGluaXRDb250cm9sbGVyKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXRDb250cm9sbGVyKCkge1xyXG4gICAgICAgICAgICBpZiAoJHN0YXRlUGFyYW1zLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgdm0udGl0bGUgPSAnRWRpdCBVc2VyJztcclxuICAgICAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkdldEJ5SWQoJHN0YXRlUGFyYW1zLl9pZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWVwIGNsb25lIHVzZXIgaW50byB2bS51c2VyIHRvIHByZXZlbnQgdW5zYXZlZCBjaGFuZ2VzIHN0YXlpbmcgaW4gdGhlIGNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHZtLnVzZXIsIHVzZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGFsZXJ0IGlmIHVzZXIgaXMgdXBkYXRlZC9kZWxldGVkIGJ5IGFub3RoZXIgdXNlclxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbigndXNlcnMnLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgX2lkID0gZGF0YS5pdGVtICYmIGRhdGEuaXRlbS5faWQgfHwgZGF0YS5faWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9pZCA9PT0gdm0udXNlci5faWQgJiYgX2lkICE9PSB2bS51cGRhdGVkSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLkVycm9yKCdUaGlzIHVzZXIgd2FzIGp1c3QgJyArIGRhdGEuYWN0aW9uICsgJyBieSBhbm90aGVyIHVzZXInKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgnZmlsZXMnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB1cGxvYWRGaWxlcygkc2NvcGUuZmlsZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gZGVsZXRlIGFueSB1bnNhdmVkIC8gb3JwaGFuZWQgZmlsZXNcclxuICAgICAgICAgICAgICAgIGlmICghdm0uc2F2ZWQgJiYgdm0udXNlci5maWxlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1bnNhdmVkRmlsZXMgPSBfLmZpbHRlcih2bS51c2VyLmZpbGVzLCBmdW5jdGlvbiAoZmlsZSkgeyByZXR1cm4gIWZpbGUuc2F2ZWQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHVuc2F2ZWRGaWxlcywgZnVuY3Rpb24gKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRmlsZVNlcnZpY2UuRGVsZXRlKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZVVzZXIodXNlcikge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLnVzZXJGb3JtLiRpbnZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghdXNlci5faWQpIHtcclxuICAgICAgICAgICAgICAgIGNyZWF0ZVVzZXIoKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVXNlcigpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVc2VyKCkge1xyXG4gICAgICAgICAgICAgICAgVXNlclNlcnZpY2UuQ3JlYXRlKHVzZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zYXZlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygndXNlcnMnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLlN1Y2Nlc3MoJ1VzZXIgY3JlYXRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUb2FzdFNlcnZpY2UuRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVVc2VyKCkge1xyXG4gICAgICAgICAgICAgICAgdm0udXBkYXRlZElkID0gdXNlci5faWQ7XHJcbiAgICAgICAgICAgICAgICBVc2VyU2VydmljZS5VcGRhdGUodXNlcilcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNhdmVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBhbnkgZmlsZXMgZmxhZ2dlZCB0byBiZSBkZWxldGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5maWxlc1RvRGVsZXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2godm0uZmlsZXNUb0RlbGV0ZSwgZnVuY3Rpb24gKGZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlU2VydmljZS5EZWxldGUoZmlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdG8gdXNlcnMgdmlld1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3VzZXJzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFRvYXN0U2VydmljZS5TdWNjZXNzKCdVc2VyIHVwZGF0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVG9hc3RTZXJ2aWNlLkVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBsb2FkRmlsZXMoZmlsZXMpIHtcclxuICAgICAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdm0udXNlci5maWxlcyA9IHZtLnVzZXIuZmlsZXMgfHwgW107XHJcbiAgICAgICAgICAgICAgICB2bS5mYWlsZWRVcGxvYWRzID0gdm0uZmFpbGVkVXBsb2FkcyB8fCBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IGZpbGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgZmlsZSBpZiBpdCdzIGFscmVhZHkgaW4gdGhlIGxpc3QgdG8gcHJldmVudCBvcnBoYW5lZCBmaWxlcyBvbiB0aGUgc2VydmVyXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4aXN0aW5nRmlsZSA9IF8uZmluZFdoZXJlKHZtLnVzZXIuZmlsZXMsIHsgbmFtZTogZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ0ZpbGUpIHJlbW92ZUZpbGUoZXhpc3RpbmdGaWxlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGZpbGUgdG8gdGhlIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2VyLmZpbGVzLnB1c2goXy5jbG9uZShmaWxlKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVwbG9hZCBmaWxlIHRvIHNlcnZlclxyXG4gICAgICAgICAgICAgICAgICAgIEZpbGVTZXJ2aWNlLlVwbG9hZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICRzY29wZS5hcGlVcmwgKyAnL3VwbG9hZHMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogZmlsZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucHJvZ3Jlc3MoZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCB7IG5hbWU6IGV2dC5jb25maWcuZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWxlLnBhdGgpIHsgLy8gcGF0aCBpcyBzZXQgb24gc3VjY2Vzc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucHJvZ3Jlc3MgPSBwYXJzZUludCgxMDAuMCAqIGV2dC5sb2FkZWQgLyBldnQudG90YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgeyBuYW1lOiBjb25maWcuZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGZpbGUucHJvZ3Jlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnBhdGggPSAnL3VwbG9hZHMvJyArIGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gXy5maW5kV2hlcmUodm0udXNlci5maWxlcywgeyBuYW1lOiBjb25maWcuZmlsZS5uYW1lIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udXNlci5maWxlcyA9IF8ud2l0aG91dCh2bS51c2VyLmZpbGVzLCBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCBmaWxlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmVycm9yID0gc3RhdHVzICsgXCIgXCIgKyBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZmFpbGVkVXBsb2Fkcy5wdXNoKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmVGaWxlKGZpbGUpIHtcclxuICAgICAgICAgICAgdm0udXNlci5maWxlcyA9IF8ud2l0aG91dCh2bS51c2VyLmZpbGVzLCBfLmZpbmRXaGVyZSh2bS51c2VyLmZpbGVzLCB7IG5hbWU6IGZpbGUubmFtZSB9KSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWZpbGUuc2F2ZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIGZpbGUgbm90IGxpbmtlZCB0byB1c2VyIHNvIGRlbGV0ZSBub3dcclxuICAgICAgICAgICAgICAgIEZpbGVTZXJ2aWNlLkRlbGV0ZShmaWxlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGZpbGUgbGlua2VkIHRvIHVzZXIgc28gZmxhZyB0byBiZSBkZWxldGVkIG9uIHNhdmVcclxuICAgICAgICAgICAgICAgIHZtLmZpbGVzVG9EZWxldGUgPSB2bS5maWxlc1RvRGVsZXRlIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgdm0uZmlsZXNUb0RlbGV0ZS5wdXNoKGZpbGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIlVzZXJTZXJ2aWNlXCIsIFwiJHRpbWVvdXRcIiwgXCIkbWREaWFsb2dcIl07XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignVXNlcnMuTWFpbkNvbnRyb2xsZXInLCBDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKCRzY29wZSwgVXNlclNlcnZpY2UsICR0aW1lb3V0LCAkbWREaWFsb2cpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS51c2VycyA9IFtdO1xyXG4gICAgICAgIHZtLmRlbGV0ZVVzZXIgPSBkZWxldGVVc2VyO1xyXG5cclxuICAgICAgICBpbml0Q29udHJvbGxlcigpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbml0Q29udHJvbGxlcigpIHtcclxuICAgICAgICAgICAgLy8gd2FpdCBmb3IgZmxleGdyaWQgdG8gaW5pdGlhbGlzZSBiZWZvcmUgbG9hZGluZyB1c2Vyc1xyXG4gICAgICAgICAgICB2YXIgd2F0Y2ggPSAkc2NvcGUuJHdhdGNoKCd2bS5mbGV4Z3JpZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5mbGV4Z3JpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRVc2VycygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyByZWxvYWQgdXNlcnMgb24gJ3VzZXJzJyBldmVudFxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kb24oJ3VzZXJzJywgZnVuY3Rpb24gKCkgeyBsb2FkVXNlcnMoKTsgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVuYmluZCB3YXRjaFxyXG4gICAgICAgICAgICAgICAgICAgIHdhdGNoKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9hZFVzZXJzKCkge1xyXG4gICAgICAgICAgICBVc2VyU2VydmljZS5HZXRBbGwoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVzZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMgPSB1c2VycztcclxuICAgICAgICAgICAgICAgICAgICB2bS5mbGV4Z3JpZC5jb2xsZWN0aW9uVmlldy5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZVVzZXIoX2lkKSB7XHJcbiAgICAgICAgICAgIFVzZXJTZXJ2aWNlLkRlbGV0ZShfaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZFVzZXJzKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
